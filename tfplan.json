{"format_version":"1.2","terraform_version":"1.9.6","variables":{"aws_region":{"value":"us-east-1"},"capacity_provider_name":{"value":"demo-ecs-ec2"},"cloudwatch_logs_name_prefix":{"value":"my-log-group-"},"cloudwatch_logs_retention_days":{"value":1},"desired_count":{"value":1},"ecs_service_count":{"value":1},"example_env_value":{"value":"example"},"existing_vpc_id":{"value":""},"name_prefix":{"value":"demo"},"project_name":{"value":"demo"},"task_cpu":{"value":"256"},"task_memory":{"value":"512"},"vpc_cidr":{"value":"10.0.0.0/16"}},"planned_values":{"outputs":{"full_access_policy_arn":{"sensitive":false},"instance_ips":{"sensitive":false},"key_name":{"sensitive":false},"selected_ecs_optimized_ami_id":{"sensitive":false,"type":"string","value":"ami-0405a351efe9c1ee0"}},"root_module":{"resources":[{"address":"aws_key_pair.generated_key","mode":"managed","type":"aws_key_pair","name":"generated_key","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"tags":null},"sensitive_values":{"tags_all":{}}},{"address":"data.aws_instances.ecs_instances","mode":"data","type":"aws_instances","name":"ecs_instances","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"filter":[{"name":"instance-state-name","values":["running"]},{"name":"tag:aws:autoscaling:groupName","values":[null]}],"instance_state_names":null,"timeouts":null},"sensitive_values":{"filter":[{"values":[false]},{"values":[false]}],"ids":[],"instance_tags":{},"ipv6_addresses":[],"private_ips":[],"public_ips":[]}},{"address":"local_file.private_key","mode":"managed","type":"local_file","name":"private_key","provider_name":"registry.terraform.io/hashicorp/local","schema_version":0,"values":{"content_base64":null,"directory_permission":"0777","file_permission":"0600","filename":"/Users/sagi/Desktop/terraform/git/ecs_auto_deployment-/ecs-instance-key.pem","sensitive_content":null,"source":null},"sensitive_values":{"content":true,"sensitive_content":true}},{"address":"null_resource.docker_login","mode":"managed","type":"null_resource","name":"docker_login","provider_name":"registry.terraform.io/hashicorp/null","schema_version":0,"values":{"triggers":null},"sensitive_values":{}},{"address":"null_resource.drain_ecs_cluster","mode":"managed","type":"null_resource","name":"drain_ecs_cluster","provider_name":"registry.terraform.io/hashicorp/null","schema_version":0,"values":{"triggers":{}},"sensitive_values":{"triggers":{}}},{"address":"random_id.unique","mode":"managed","type":"random_id","name":"unique","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}},{"address":"tls_private_key.ssh_key","mode":"managed","type":"tls_private_key","name":"ssh_key","provider_name":"registry.terraform.io/hashicorp/tls","schema_version":1,"values":{"algorithm":"RSA","ecdsa_curve":"P224","rsa_bits":4096},"sensitive_values":{"private_key_openssh":true,"private_key_pem":true,"private_key_pem_pkcs8":true}}],"child_modules":[{"resources":[{"address":"module.alb.aws_lb.main","mode":"managed","type":"aws_lb","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"access_logs":[],"client_keep_alive":3600,"connection_logs":[],"customer_owned_ipv4_pool":null,"desync_mitigation_mode":"defensive","dns_record_client_routing_policy":null,"drop_invalid_header_fields":false,"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"enable_tls_version_and_cipher_suite_headers":false,"enable_waf_fail_open":false,"enable_xff_client_port":false,"idle_timeout":60,"load_balancer_type":"application","name":"demo-alb","preserve_host_header":false,"timeouts":null,"xff_header_processing_mode":"append"},"sensitive_values":{"access_logs":[],"connection_logs":[],"security_groups":[],"subnet_mapping":[],"subnets":[],"tags":{},"tags_all":{}}},{"address":"module.alb.aws_lb_listener.http","mode":"managed","type":"aws_lb_listener","name":"http","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"alpn_policy":null,"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[],"type":"forward"}],"port":80,"protocol":"HTTP","tags":null,"timeouts":null},"sensitive_values":{"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[]}],"mutual_authentication":[],"tags_all":{}}},{"address":"module.alb.aws_lb_target_group.app","mode":"managed","type":"aws_lb_target_group","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"deregistration_delay":"300","health_check":[{"enabled":true,"healthy_threshold":2,"interval":60,"matcher":"200,301,302","path":"/","port":"traffic-port","protocol":"HTTP","timeout":30,"unhealthy_threshold":10}],"lambda_multi_value_headers_enabled":false,"port":80,"protocol":"HTTP","proxy_protocol_v2":false,"slow_start":0,"stickiness":[{"cookie_duration":86400,"cookie_name":null,"enabled":true,"type":"lb_cookie"}],"tags":null,"target_type":"instance"},"sensitive_values":{"health_check":[{}],"load_balancer_arns":[],"stickiness":[{}],"tags_all":{},"target_failover":[],"target_group_health":[],"target_health_state":[]}},{"address":"module.alb.aws_security_group.http","mode":"managed","type":"aws_security_group","name":"http","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Allow all HTTP/HTTPS traffic from public","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443},{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name_prefix":"http-sg-","revoke_rules_on_delete":false,"tags":null,"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags_all":{}}},{"address":"module.alb.random_id.target_group_suffix","mode":"managed","type":"random_id","name":"target_group_suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}}],"address":"module.alb"},{"resources":[{"address":"module.ecs_asg.aws_autoscaling_group.ecs","mode":"managed","type":"aws_autoscaling_group","name":"ecs","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"capacity_rebalance":null,"context":null,"default_instance_warmup":null,"desired_capacity":1,"desired_capacity_type":null,"enabled_metrics":null,"force_delete":false,"force_delete_warm_pool":false,"health_check_grace_period":0,"health_check_type":"EC2","ignore_failed_scaling_activities":false,"initial_lifecycle_hook":[],"instance_maintenance_policy":[],"instance_refresh":[],"launch_configuration":null,"launch_template":[{"version":"$Latest"}],"max_instance_lifetime":null,"max_size":2,"metrics_granularity":"1Minute","min_elb_capacity":null,"min_size":1,"placement_group":null,"protect_from_scale_in":false,"suspended_processes":null,"tag":[{"key":"AmazonECSManaged","propagate_at_launch":true,"value":"true"},{"key":"Name","propagate_at_launch":true}],"termination_policies":null,"timeouts":null,"wait_for_capacity_timeout":"10m","wait_for_elb_capacity":null,"warm_pool":[]},"sensitive_values":{"availability_zones":[],"initial_lifecycle_hook":[],"instance_maintenance_policy":[],"instance_refresh":[],"launch_template":[{}],"load_balancers":[],"mixed_instances_policy":[],"tag":[{},{}],"target_group_arns":[],"traffic_source":[],"vpc_zone_identifier":[],"warm_pool":[]}}],"address":"module.ecs_asg"},{"resources":[{"address":"module.ecs_capacity_provider.aws_ecs_capacity_provider.main","mode":"managed","type":"aws_ecs_capacity_provider","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"auto_scaling_group_provider":[{"managed_scaling":[{"maximum_scaling_step_size":1,"minimum_scaling_step_size":1,"status":"ENABLED","target_capacity":100}],"managed_termination_protection":"DISABLED"}],"tags":null},"sensitive_values":{"auto_scaling_group_provider":[{"managed_scaling":[{}]}],"tags_all":{}}},{"address":"module.ecs_capacity_provider.aws_ecs_cluster_capacity_providers.main","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"default_capacity_provider_strategy":[{"base":1,"weight":100}]},"sensitive_values":{"capacity_providers":[],"default_capacity_provider_strategy":[{}]}}],"address":"module.ecs_capacity_provider"},{"resources":[{"address":"module.ecs_cluster.aws_ecs_cluster.main","mode":"managed","type":"aws_ecs_cluster","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"configuration":[],"service_connect_defaults":[],"tags":null},"sensitive_values":{"configuration":[],"service_connect_defaults":[],"setting":[],"tags_all":{}}},{"address":"module.ecs_cluster.aws_ecs_cluster_capacity_providers.main","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"default_capacity_provider_strategy":[{"base":1,"weight":100}]},"sensitive_values":{"capacity_providers":[],"default_capacity_provider_strategy":[{}]}}],"address":"module.ecs_cluster"},{"resources":[{"address":"module.ecs_launch_template.aws_launch_template.ecs_ec2","mode":"managed","type":"aws_launch_template","name":"ecs_ec2","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"description":null,"disable_api_stop":null,"disable_api_termination":null,"ebs_optimized":null,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{"name":null}],"image_id":"ami-0405a351efe9c1ee0","instance_initiated_shutdown_behavior":null,"instance_market_options":[],"instance_requirements":[],"instance_type":"t2.micro","kernel_id":null,"license_specification":[],"maintenance_options":[],"monitoring":[],"network_interfaces":[{"associate_carrier_ip_address":null,"associate_public_ip_address":"true","delete_on_termination":null,"description":null,"device_index":null,"interface_type":null,"ipv4_address_count":null,"ipv4_addresses":null,"ipv4_prefix_count":null,"ipv4_prefixes":null,"ipv6_address_count":null,"ipv6_addresses":null,"ipv6_prefix_count":null,"ipv6_prefixes":null,"network_card_index":null,"network_interface_id":null,"primary_ipv6":null,"private_ip_address":null,"subnet_id":null}],"placement":[],"private_dns_name_options":[],"ram_disk_id":null,"security_group_names":null,"tag_specifications":[],"tags":null,"update_default_version":null,"vpc_security_group_ids":null},"sensitive_values":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{}],"instance_market_options":[],"instance_requirements":[],"license_specification":[],"maintenance_options":[],"metadata_options":[],"monitoring":[],"network_interfaces":[{"security_groups":[]}],"placement":[],"private_dns_name_options":[],"tag_specifications":[],"tags_all":{}}}],"address":"module.ecs_launch_template"},{"resources":[{"address":"module.ecs_node_role.aws_iam_instance_profile.ecs_node","mode":"managed","type":"aws_iam_instance_profile","name":"ecs_node","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"path":"/ecs/instance/","tags":null},"sensitive_values":{"tags_all":{}}},{"address":"module.ecs_node_role.aws_iam_policy.full_access","mode":"managed","type":"aws_iam_policy","name":"full_access","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Full access to EC2, ECS, and CloudWatch Logs","path":"/","policy":"{\"Statement\":[{\"Action\":[\"logs:*\",\"ecs:*\",\"ec2:*\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":null},"sensitive_values":{"tags_all":{}}},{"address":"module.ecs_node_role.aws_iam_role.ecs_exec_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"module.ecs_node_role.aws_iam_role.ecs_node_role","mode":"managed","type":"aws_iam_role","name":"ecs_node_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ecs-tasks.amazonaws.com\",\"ec2.amazonaws.com\"]}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_cloudwatch_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_cloudwatch_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/CloudWatchLogsFullAccess"},"sensitive_values":{}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_exec_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"sensitive_values":{}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_node_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_node_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"},"sensitive_values":{}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.full_access_exec","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_exec","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"sensitive_values":{}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.full_access_node","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_node","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"sensitive_values":{}}],"address":"module.ecs_node_role"},{"resources":[{"address":"module.ecs_node_sg.aws_security_group.ecs_node_sg","mode":"managed","type":"aws_security_group","name":"ecs_node_sg","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Security group for ECS nodes","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP from anywhere","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow ICMP from anywhere","from_port":-1,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"icmp","security_groups":[],"self":false,"to_port":-1},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH from anywhere","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":[],"description":"Allow all inbound traffic from ALB","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":65535}],"revoke_rules_on_delete":false,"timeouts":null},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}},{"address":"module.ecs_node_sg.aws_security_group_rule.allow_all_vpc","mode":"managed","type":"aws_security_group_rule","name":"allow_all_vpc","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":2,"values":{"description":null,"from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","self":false,"timeouts":null,"to_port":65535,"type":"ingress"},"sensitive_values":{"cidr_blocks":[]}},{"address":"module.ecs_node_sg.aws_security_group_rule.allow_container_ports","mode":"managed","type":"aws_security_group_rule","name":"allow_container_ports","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow inbound traffic on container ports","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","self":false,"timeouts":null,"to_port":65535,"type":"ingress"},"sensitive_values":{"cidr_blocks":[false]}},{"address":"module.ecs_node_sg.data.aws_vpc.selected","mode":"data","type":"aws_vpc","name":"selected","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"filter":[],"timeouts":null},"sensitive_values":{"cidr_block_associations":[],"filter":[],"tags":{}}}],"address":"module.ecs_node_sg"},{"resources":[{"address":"module.ecs_service.aws_ecs_service.app","mode":"managed","type":"aws_ecs_service","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"alarms":[],"deployment_circuit_breaker":[{"enable":true,"rollback":true}],"deployment_controller":[{"type":"ECS"}],"deployment_maximum_percent":200,"deployment_minimum_healthy_percent":100,"desired_count":2,"enable_ecs_managed_tags":false,"enable_execute_command":false,"force_delete":null,"force_new_deployment":null,"health_check_grace_period_seconds":null,"load_balancer":[{"container_name":"nginx-nginx","container_port":80,"elb_name":""}],"network_configuration":[],"ordered_placement_strategy":[{"field":"instanceId","type":"spread"}],"placement_constraints":[{"expression":"","type":"distinctInstance"}],"propagate_tags":null,"scheduling_strategy":"REPLICA","service_connect_configuration":[],"service_registries":[],"tags":null,"timeouts":null,"volume_configuration":[],"wait_for_steady_state":false},"sensitive_values":{"alarms":[],"capacity_provider_strategy":[],"deployment_circuit_breaker":[{}],"deployment_controller":[{}],"load_balancer":[{}],"network_configuration":[],"ordered_placement_strategy":[{}],"placement_constraints":[{}],"service_connect_configuration":[],"service_registries":[],"tags_all":{},"triggers":{},"volume_configuration":[]}}],"address":"module.ecs_service"},{"resources":[{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_cpu","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_cpu","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"application-scaling-policy-cpu","policy_type":"TargetTrackingScaling","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"disable_scale_in":false,"predefined_metric_specification":[{"predefined_metric_type":"ECSServiceAverageCPUUtilization","resource_label":null}],"scale_in_cooldown":300,"scale_out_cooldown":300,"target_value":80}]},"sensitive_values":{"alarm_arns":[],"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]}},{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_memory","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_memory","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"application-scaling-policy-memory","policy_type":"TargetTrackingScaling","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"disable_scale_in":false,"predefined_metric_specification":[{"predefined_metric_type":"ECSServiceAverageMemoryUtilization","resource_label":null}],"scale_in_cooldown":300,"scale_out_cooldown":300,"target_value":80}]},"sensitive_values":{"alarm_arns":[],"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]}},{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","mode":"managed","type":"aws_appautoscaling_target","name":"ecs_target","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"max_capacity":5,"min_capacity":2,"scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","tags":null},"sensitive_values":{"suspended_state":[],"tags_all":{}}}],"address":"module.ecs_service_auto_scaling"},{"resources":[{"address":"module.ecs_task_definition.aws_ecs_task_definition.app","mode":"managed","type":"aws_ecs_task_definition","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"cpu":"256","ephemeral_storage":[],"inference_accelerator":[],"ipc_mode":null,"memory":"512","network_mode":"bridge","pid_mode":null,"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":["EC2"],"runtime_platform":[],"skip_destroy":false,"tags":null,"track_latest":false,"volume":[{"docker_volume_configuration":[],"efs_volume_configuration":[],"fsx_windows_file_server_volume_configuration":[],"host_path":"/var/log/ecs/nginx","name":"nginx-logs"}]},"sensitive_values":{"ephemeral_storage":[],"inference_accelerator":[],"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":[false],"runtime_platform":[],"tags_all":{},"volume":[{"docker_volume_configuration":[],"efs_volume_configuration":[],"fsx_windows_file_server_volume_configuration":[]}]}}],"address":"module.ecs_task_definition"},{"resources":[{"address":"module.ecs_task_role.aws_iam_role.ecs_exec_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"module.ecs_task_role.aws_iam_role.ecs_task_role","mode":"managed","type":"aws_iam_role","name":"ecs_task_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"module.ecs_task_role.aws_iam_role_policy_attachment.ecs_exec_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"sensitive_values":{}}],"address":"module.ecs_task_role"},{"resources":[{"address":"module.internet_gateway.aws_eip.main[0]","mode":"managed","type":"aws_eip","name":"main","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-us-east-1a"},"tags_all":{"Name":"demo-eip-us-east-1a"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.internet_gateway.aws_eip.main[1]","mode":"managed","type":"aws_eip","name":"main","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-us-east-1b"},"tags_all":{"Name":"demo-eip-us-east-1b"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.internet_gateway.aws_internet_gateway.main","mode":"managed","type":"aws_internet_gateway","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}}],"address":"module.internet_gateway"},{"resources":[{"address":"module.log_group.aws_cloudwatch_log_group.this","mode":"managed","type":"aws_cloudwatch_log_group","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"kms_key_id":null,"retention_in_days":1,"skip_destroy":false,"tags":null},"sensitive_values":{"tags_all":{}}},{"address":"module.log_group.aws_cloudwatch_log_stream.this","mode":"managed","type":"aws_cloudwatch_log_stream","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"sensitive_values":{}}],"address":"module.log_group"},{"resources":[{"address":"module.nat_gateway.aws_eip.nat","mode":"managed","type":"aws_eip","name":"nat","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-nat"},"tags_all":{"Name":"demo-eip-nat"},"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.nat_gateway.aws_nat_gateway.main","mode":"managed","type":"aws_nat_gateway","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"connectivity_type":"public","secondary_allocation_ids":null,"tags":{"Name":"demo-nat-gw"},"tags_all":{"Name":"demo-nat-gw"},"timeouts":null},"sensitive_values":{"secondary_private_ip_addresses":[],"tags":{},"tags_all":{}}}],"address":"module.nat_gateway"},{"resources":[{"address":"module.route_table.aws_route.private_nat_gateway[0]","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{}},{"address":"module.route_table.aws_route.private_nat_gateway[1]","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{}},{"address":"module.route_table.aws_route.public_internet_gateway","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"local_gateway_id":null,"nat_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"sensitive_values":{}},{"address":"module.route_table.aws_route_table.private[0]","mode":"managed","type":"aws_route_table","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"Name":"demo-private-rt-1"},"tags_all":{"Name":"demo-private-rt-1"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.route_table.aws_route_table.private[1]","mode":"managed","type":"aws_route_table","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"Name":"demo-private-rt-2"},"tags_all":{"Name":"demo-private-rt-2"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.route_table.aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"tags":{"Name":"demo-public-rt"},"tags_all":{"Name":"demo-public-rt"},"timeouts":null},"sensitive_values":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}},{"address":"module.route_table.aws_route_table_association.private[0]","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.route_table.aws_route_table_association.private[1]","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.route_table.aws_route_table_association.public[0]","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}},{"address":"module.route_table.aws_route_table_association.public[1]","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"gateway_id":null,"timeouts":null},"sensitive_values":{}}],"address":"module.route_table"},{"resources":[{"address":"module.vpc.aws_subnet.private[0]","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.private[1]","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.public[0]","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.0.0.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_subnet.public[1]","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"timeouts":null},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"module.vpc.aws_vpc.main","mode":"managed","type":"aws_vpc","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null},"sensitive_values":{"tags":{},"tags_all":{}}}],"address":"module.vpc"}]}},"resource_changes":[{"address":"data.aws_instances.ecs_instances","mode":"data","type":"aws_instances","name":"ecs_instances","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["read"],"before":null,"after":{"filter":[{"name":"instance-state-name","values":["running"]},{"name":"tag:aws:autoscaling:groupName","values":[null]}],"instance_state_names":null,"timeouts":null},"after_unknown":{"filter":[{"values":[false]},{"values":[true]}],"id":true,"ids":true,"instance_tags":true,"ipv6_addresses":true,"private_ips":true,"public_ips":true},"before_sensitive":false,"after_sensitive":{"filter":[{"values":[false]},{"values":[false]}],"ids":[],"instance_tags":{},"ipv6_addresses":[],"private_ips":[],"public_ips":[]}},"action_reason":"read_because_config_unknown"},{"address":"aws_key_pair.generated_key","mode":"managed","type":"aws_key_pair","name":"generated_key","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":null},"after_unknown":{"arn":true,"fingerprint":true,"id":true,"key_name":true,"key_name_prefix":true,"key_pair_id":true,"key_type":true,"public_key":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"local_file.private_key","mode":"managed","type":"local_file","name":"private_key","provider_name":"registry.terraform.io/hashicorp/local","change":{"actions":["create"],"before":null,"after":{"content_base64":null,"directory_permission":"0777","file_permission":"0600","filename":"/Users/sagi/Desktop/terraform/git/ecs_auto_deployment-/ecs-instance-key.pem","sensitive_content":null,"source":null},"after_unknown":{"content":true,"content_base64sha256":true,"content_base64sha512":true,"content_md5":true,"content_sha1":true,"content_sha256":true,"content_sha512":true,"id":true},"before_sensitive":false,"after_sensitive":{"content":true,"sensitive_content":true}}},{"address":"null_resource.docker_login","mode":"managed","type":"null_resource","name":"docker_login","provider_name":"registry.terraform.io/hashicorp/null","change":{"actions":["create"],"before":null,"after":{"triggers":null},"after_unknown":{"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"null_resource.drain_ecs_cluster","mode":"managed","type":"null_resource","name":"drain_ecs_cluster","provider_name":"registry.terraform.io/hashicorp/null","change":{"actions":["create"],"before":null,"after":{"triggers":{}},"after_unknown":{"id":true,"triggers":{"cluster_name":true}},"before_sensitive":false,"after_sensitive":{"triggers":{}}}},{"address":"random_id.unique","mode":"managed","type":"random_id","name":"unique","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"tls_private_key.ssh_key","mode":"managed","type":"tls_private_key","name":"ssh_key","provider_name":"registry.terraform.io/hashicorp/tls","change":{"actions":["create"],"before":null,"after":{"algorithm":"RSA","ecdsa_curve":"P224","rsa_bits":4096},"after_unknown":{"id":true,"private_key_openssh":true,"private_key_pem":true,"private_key_pem_pkcs8":true,"public_key_fingerprint_md5":true,"public_key_fingerprint_sha256":true,"public_key_openssh":true,"public_key_pem":true},"before_sensitive":false,"after_sensitive":{"private_key_openssh":true,"private_key_pem":true,"private_key_pem_pkcs8":true}}},{"address":"module.alb.aws_lb.main","module_address":"module.alb","mode":"managed","type":"aws_lb","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"access_logs":[],"client_keep_alive":3600,"connection_logs":[],"customer_owned_ipv4_pool":null,"desync_mitigation_mode":"defensive","dns_record_client_routing_policy":null,"drop_invalid_header_fields":false,"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"enable_tls_version_and_cipher_suite_headers":false,"enable_waf_fail_open":false,"enable_xff_client_port":false,"idle_timeout":60,"load_balancer_type":"application","name":"demo-alb","preserve_host_header":false,"timeouts":null,"xff_header_processing_mode":"append"},"after_unknown":{"access_logs":[],"arn":true,"arn_suffix":true,"connection_logs":[],"dns_name":true,"enforce_security_group_inbound_rules_on_private_link_traffic":true,"id":true,"internal":true,"ip_address_type":true,"name_prefix":true,"security_groups":true,"subnet_mapping":true,"subnets":true,"tags":true,"tags_all":true,"vpc_id":true,"zone_id":true},"before_sensitive":false,"after_sensitive":{"access_logs":[],"connection_logs":[],"security_groups":[],"subnet_mapping":[],"subnets":[],"tags":{},"tags_all":{}}}},{"address":"module.alb.aws_lb_listener.http","module_address":"module.alb","mode":"managed","type":"aws_lb_listener","name":"http","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"alpn_policy":null,"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[],"type":"forward"}],"port":80,"protocol":"HTTP","tags":null,"timeouts":null},"after_unknown":{"arn":true,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"order":true,"redirect":[],"target_group_arn":true}],"id":true,"load_balancer_arn":true,"mutual_authentication":true,"ssl_policy":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[]}],"mutual_authentication":[],"tags_all":{}}}},{"address":"module.alb.aws_lb_target_group.app","module_address":"module.alb","mode":"managed","type":"aws_lb_target_group","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"deregistration_delay":"300","health_check":[{"enabled":true,"healthy_threshold":2,"interval":60,"matcher":"200,301,302","path":"/","port":"traffic-port","protocol":"HTTP","timeout":30,"unhealthy_threshold":10}],"lambda_multi_value_headers_enabled":false,"port":80,"protocol":"HTTP","proxy_protocol_v2":false,"slow_start":0,"stickiness":[{"cookie_duration":86400,"cookie_name":null,"enabled":true,"type":"lb_cookie"}],"tags":null,"target_type":"instance"},"after_unknown":{"arn":true,"arn_suffix":true,"connection_termination":true,"health_check":[{}],"id":true,"ip_address_type":true,"load_balancer_arns":true,"load_balancing_algorithm_type":true,"load_balancing_anomaly_mitigation":true,"load_balancing_cross_zone_enabled":true,"name":true,"name_prefix":true,"preserve_client_ip":true,"protocol_version":true,"stickiness":[{}],"tags_all":true,"target_failover":true,"target_group_health":true,"target_health_state":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"health_check":[{}],"load_balancer_arns":[],"stickiness":[{}],"tags_all":{},"target_failover":[],"target_group_health":[],"target_health_state":[]}}},{"address":"module.alb.aws_security_group.http","module_address":"module.alb","mode":"managed","type":"aws_security_group","name":"http","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Allow all HTTP/HTTPS traffic from public","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":443},{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name_prefix":"http-sg-","revoke_rules_on_delete":false,"tags":null,"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name":true,"owner_id":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags_all":{}}}},{"address":"module.alb.random_id.target_group_suffix","module_address":"module.alb","mode":"managed","type":"random_id","name":"target_group_suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_asg.aws_autoscaling_group.ecs","module_address":"module.ecs_asg","mode":"managed","type":"aws_autoscaling_group","name":"ecs","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"capacity_rebalance":null,"context":null,"default_instance_warmup":null,"desired_capacity":1,"desired_capacity_type":null,"enabled_metrics":null,"force_delete":false,"force_delete_warm_pool":false,"health_check_grace_period":0,"health_check_type":"EC2","ignore_failed_scaling_activities":false,"initial_lifecycle_hook":[],"instance_maintenance_policy":[],"instance_refresh":[],"launch_configuration":null,"launch_template":[{"version":"$Latest"}],"max_instance_lifetime":null,"max_size":2,"metrics_granularity":"1Minute","min_elb_capacity":null,"min_size":1,"placement_group":null,"protect_from_scale_in":false,"suspended_processes":null,"tag":[{"key":"AmazonECSManaged","propagate_at_launch":true,"value":"true"},{"key":"Name","propagate_at_launch":true}],"termination_policies":null,"timeouts":null,"wait_for_capacity_timeout":"10m","wait_for_elb_capacity":null,"warm_pool":[]},"after_unknown":{"arn":true,"availability_zones":true,"default_cooldown":true,"id":true,"initial_lifecycle_hook":[],"instance_maintenance_policy":[],"instance_refresh":[],"launch_template":[{"id":true,"name":true}],"load_balancers":true,"mixed_instances_policy":true,"name":true,"name_prefix":true,"predicted_capacity":true,"service_linked_role_arn":true,"tag":[{},{"value":true}],"target_group_arns":true,"traffic_source":true,"vpc_zone_identifier":true,"warm_pool":[],"warm_pool_size":true},"before_sensitive":false,"after_sensitive":{"availability_zones":[],"initial_lifecycle_hook":[],"instance_maintenance_policy":[],"instance_refresh":[],"launch_template":[{}],"load_balancers":[],"mixed_instances_policy":[],"tag":[{},{}],"target_group_arns":[],"traffic_source":[],"vpc_zone_identifier":[],"warm_pool":[]}}},{"address":"module.ecs_capacity_provider.aws_ecs_capacity_provider.main","module_address":"module.ecs_capacity_provider","mode":"managed","type":"aws_ecs_capacity_provider","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"auto_scaling_group_provider":[{"managed_scaling":[{"maximum_scaling_step_size":1,"minimum_scaling_step_size":1,"status":"ENABLED","target_capacity":100}],"managed_termination_protection":"DISABLED"}],"tags":null},"after_unknown":{"arn":true,"auto_scaling_group_provider":[{"auto_scaling_group_arn":true,"managed_draining":true,"managed_scaling":[{"instance_warmup_period":true}]}],"id":true,"name":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"auto_scaling_group_provider":[{"managed_scaling":[{}]}],"tags_all":{}}}},{"address":"module.ecs_capacity_provider.aws_ecs_cluster_capacity_providers.main","module_address":"module.ecs_capacity_provider","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"default_capacity_provider_strategy":[{"base":1,"weight":100}]},"after_unknown":{"capacity_providers":true,"cluster_name":true,"default_capacity_provider_strategy":[{"capacity_provider":true}],"id":true},"before_sensitive":false,"after_sensitive":{"capacity_providers":[],"default_capacity_provider_strategy":[{}]}}},{"address":"module.ecs_cluster.aws_ecs_cluster.main","module_address":"module.ecs_cluster","mode":"managed","type":"aws_ecs_cluster","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"configuration":[],"service_connect_defaults":[],"tags":null},"after_unknown":{"arn":true,"configuration":[],"id":true,"name":true,"service_connect_defaults":[],"setting":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"configuration":[],"service_connect_defaults":[],"setting":[],"tags_all":{}}}},{"address":"module.ecs_cluster.aws_ecs_cluster_capacity_providers.main","module_address":"module.ecs_cluster","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"default_capacity_provider_strategy":[{"base":1,"weight":100}]},"after_unknown":{"capacity_providers":true,"cluster_name":true,"default_capacity_provider_strategy":[{"capacity_provider":true}],"id":true},"before_sensitive":false,"after_sensitive":{"capacity_providers":[],"default_capacity_provider_strategy":[{}]}}},{"address":"module.ecs_launch_template.aws_launch_template.ecs_ec2","module_address":"module.ecs_launch_template","mode":"managed","type":"aws_launch_template","name":"ecs_ec2","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"description":null,"disable_api_stop":null,"disable_api_termination":null,"ebs_optimized":null,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{"name":null}],"image_id":"ami-0405a351efe9c1ee0","instance_initiated_shutdown_behavior":null,"instance_market_options":[],"instance_requirements":[],"instance_type":"t2.micro","kernel_id":null,"license_specification":[],"maintenance_options":[],"monitoring":[],"network_interfaces":[{"associate_carrier_ip_address":null,"associate_public_ip_address":"true","delete_on_termination":null,"description":null,"device_index":null,"interface_type":null,"ipv4_address_count":null,"ipv4_addresses":null,"ipv4_prefix_count":null,"ipv4_prefixes":null,"ipv6_address_count":null,"ipv6_addresses":null,"ipv6_prefix_count":null,"ipv6_prefixes":null,"network_card_index":null,"network_interface_id":null,"primary_ipv6":null,"private_ip_address":null,"subnet_id":null}],"placement":[],"private_dns_name_options":[],"ram_disk_id":null,"security_group_names":null,"tag_specifications":[],"tags":null,"update_default_version":null,"vpc_security_group_ids":null},"after_unknown":{"arn":true,"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"default_version":true,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{"arn":true}],"id":true,"instance_market_options":[],"instance_requirements":[],"key_name":true,"latest_version":true,"license_specification":[],"maintenance_options":[],"metadata_options":true,"monitoring":[],"name":true,"name_prefix":true,"network_interfaces":[{"security_groups":true}],"placement":[],"private_dns_name_options":[],"tag_specifications":[],"tags_all":true,"user_data":true},"before_sensitive":false,"after_sensitive":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{}],"instance_market_options":[],"instance_requirements":[],"license_specification":[],"maintenance_options":[],"metadata_options":[],"monitoring":[],"network_interfaces":[{"security_groups":[]}],"placement":[],"private_dns_name_options":[],"tag_specifications":[],"tags_all":{}}}},{"address":"module.ecs_node_role.aws_iam_instance_profile.ecs_node","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_instance_profile","name":"ecs_node","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"path":"/ecs/instance/","tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"name":true,"name_prefix":true,"role":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"module.ecs_node_role.aws_iam_policy.full_access","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_policy","name":"full_access","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Full access to EC2, ECS, and CloudWatch Logs","path":"/","policy":"{\"Statement\":[{\"Action\":[\"logs:*\",\"ecs:*\",\"ec2:*\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":null},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name":true,"name_prefix":true,"policy_id":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"module.ecs_node_role.aws_iam_role.ecs_exec_role","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"module.ecs_node_role.aws_iam_role.ecs_node_role","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role","name":"ecs_node_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ecs-tasks.amazonaws.com\",\"ec2.amazonaws.com\"]}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_cloudwatch_policy","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_cloudwatch_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/CloudWatchLogsFullAccess"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_exec_role_policy","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.ecs_node_role_policy","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_node_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.full_access_exec","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_exec","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"policy_arn":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_node_role.aws_iam_role_policy_attachment.full_access_node","module_address":"module.ecs_node_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_node","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"policy_arn":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.ecs_node_sg.data.aws_vpc.selected","module_address":"module.ecs_node_sg","mode":"data","type":"aws_vpc","name":"selected","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["read"],"before":null,"after":{"filter":[],"timeouts":null},"after_unknown":{"arn":true,"cidr_block":true,"cidr_block_associations":true,"default":true,"dhcp_options_id":true,"enable_dns_hostnames":true,"enable_dns_support":true,"enable_network_address_usage_metrics":true,"filter":[],"id":true,"instance_tenancy":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"main_route_table_id":true,"owner_id":true,"state":true,"tags":true},"before_sensitive":false,"after_sensitive":{"cidr_block_associations":[],"filter":[],"tags":{}}},"action_reason":"read_because_config_unknown"},{"address":"module.ecs_node_sg.aws_security_group.ecs_node_sg","module_address":"module.ecs_node_sg","mode":"managed","type":"aws_security_group","name":"ecs_node_sg","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Security group for ECS nodes","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP from anywhere","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow ICMP from anywhere","from_port":-1,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"icmp","security_groups":[],"self":false,"to_port":-1},{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH from anywhere","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":[],"description":"Allow all inbound traffic from ALB","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":65535}],"revoke_rules_on_delete":false,"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":true}],"name":true,"name_prefix":true,"owner_id":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}}}},{"address":"module.ecs_node_sg.aws_security_group_rule.allow_all_vpc","module_address":"module.ecs_node_sg","mode":"managed","type":"aws_security_group_rule","name":"allow_all_vpc","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","self":false,"timeouts":null,"to_port":65535,"type":"ingress"},"after_unknown":{"cidr_blocks":true,"id":true,"security_group_id":true,"security_group_rule_id":true,"source_security_group_id":true},"before_sensitive":false,"after_sensitive":{"cidr_blocks":[]}}},{"address":"module.ecs_node_sg.aws_security_group_rule.allow_container_ports","module_address":"module.ecs_node_sg","mode":"managed","type":"aws_security_group_rule","name":"allow_container_ports","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow inbound traffic on container ports","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","self":false,"timeouts":null,"to_port":65535,"type":"ingress"},"after_unknown":{"cidr_blocks":[false],"id":true,"security_group_id":true,"security_group_rule_id":true,"source_security_group_id":true},"before_sensitive":false,"after_sensitive":{"cidr_blocks":[false]}}},{"address":"module.ecs_service.aws_ecs_service.app","module_address":"module.ecs_service","mode":"managed","type":"aws_ecs_service","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"alarms":[],"deployment_circuit_breaker":[{"enable":true,"rollback":true}],"deployment_controller":[{"type":"ECS"}],"deployment_maximum_percent":200,"deployment_minimum_healthy_percent":100,"desired_count":2,"enable_ecs_managed_tags":false,"enable_execute_command":false,"force_delete":null,"force_new_deployment":null,"health_check_grace_period_seconds":null,"load_balancer":[{"container_name":"nginx-nginx","container_port":80,"elb_name":""}],"network_configuration":[],"ordered_placement_strategy":[{"field":"instanceId","type":"spread"}],"placement_constraints":[{"expression":"","type":"distinctInstance"}],"propagate_tags":null,"scheduling_strategy":"REPLICA","service_connect_configuration":[],"service_registries":[],"tags":null,"timeouts":null,"volume_configuration":[],"wait_for_steady_state":false},"after_unknown":{"alarms":[],"capacity_provider_strategy":true,"cluster":true,"deployment_circuit_breaker":[{}],"deployment_controller":[{}],"iam_role":true,"id":true,"launch_type":true,"load_balancer":[{"target_group_arn":true}],"name":true,"network_configuration":[],"ordered_placement_strategy":[{}],"placement_constraints":[{}],"platform_version":true,"service_connect_configuration":[],"service_registries":[],"tags_all":true,"task_definition":true,"triggers":true,"volume_configuration":[]},"before_sensitive":false,"after_sensitive":{"alarms":[],"capacity_provider_strategy":[],"deployment_circuit_breaker":[{}],"deployment_controller":[{}],"load_balancer":[{}],"network_configuration":[],"ordered_placement_strategy":[{}],"placement_constraints":[{}],"service_connect_configuration":[],"service_registries":[],"tags_all":{},"triggers":{},"volume_configuration":[]}}},{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_cpu","module_address":"module.ecs_service_auto_scaling","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_cpu","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"application-scaling-policy-cpu","policy_type":"TargetTrackingScaling","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"disable_scale_in":false,"predefined_metric_specification":[{"predefined_metric_type":"ECSServiceAverageCPUUtilization","resource_label":null}],"scale_in_cooldown":300,"scale_out_cooldown":300,"target_value":80}]},"after_unknown":{"alarm_arns":true,"arn":true,"id":true,"resource_id":true,"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]},"before_sensitive":false,"after_sensitive":{"alarm_arns":[],"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]}}},{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_memory","module_address":"module.ecs_service_auto_scaling","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_memory","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"application-scaling-policy-memory","policy_type":"TargetTrackingScaling","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"disable_scale_in":false,"predefined_metric_specification":[{"predefined_metric_type":"ECSServiceAverageMemoryUtilization","resource_label":null}],"scale_in_cooldown":300,"scale_out_cooldown":300,"target_value":80}]},"after_unknown":{"alarm_arns":true,"arn":true,"id":true,"resource_id":true,"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]},"before_sensitive":false,"after_sensitive":{"alarm_arns":[],"step_scaling_policy_configuration":[],"target_tracking_scaling_policy_configuration":[{"customized_metric_specification":[],"predefined_metric_specification":[{}]}]}}},{"address":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","module_address":"module.ecs_service_auto_scaling","mode":"managed","type":"aws_appautoscaling_target","name":"ecs_target","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"max_capacity":5,"min_capacity":2,"scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","tags":null},"after_unknown":{"arn":true,"id":true,"resource_id":true,"role_arn":true,"suspended_state":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"suspended_state":[],"tags_all":{}}}},{"address":"module.ecs_task_definition.aws_ecs_task_definition.app","module_address":"module.ecs_task_definition","mode":"managed","type":"aws_ecs_task_definition","name":"app","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"cpu":"256","ephemeral_storage":[],"inference_accelerator":[],"ipc_mode":null,"memory":"512","network_mode":"bridge","pid_mode":null,"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":["EC2"],"runtime_platform":[],"skip_destroy":false,"tags":null,"track_latest":false,"volume":[{"docker_volume_configuration":[],"efs_volume_configuration":[],"fsx_windows_file_server_volume_configuration":[],"host_path":"/var/log/ecs/nginx","name":"nginx-logs"}]},"after_unknown":{"arn":true,"arn_without_revision":true,"container_definitions":true,"ephemeral_storage":[],"execution_role_arn":true,"family":true,"id":true,"inference_accelerator":[],"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":[false],"revision":true,"runtime_platform":[],"tags_all":true,"task_role_arn":true,"volume":[{"configure_at_launch":true,"docker_volume_configuration":[],"efs_volume_configuration":[],"fsx_windows_file_server_volume_configuration":[]}]},"before_sensitive":false,"after_sensitive":{"ephemeral_storage":[],"inference_accelerator":[],"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":[false],"runtime_platform":[],"tags_all":{},"volume":[{"docker_volume_configuration":[],"efs_volume_configuration":[],"fsx_windows_file_server_volume_configuration":[]}]}}},{"address":"module.ecs_task_role.aws_iam_role.ecs_exec_role","module_address":"module.ecs_task_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"module.ecs_task_role.aws_iam_role.ecs_task_role","module_address":"module.ecs_task_role","mode":"managed","type":"aws_iam_role","name":"ecs_task_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"module.ecs_task_role.aws_iam_role_policy_attachment.ecs_exec_role_policy","module_address":"module.ecs_task_role","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"after_unknown":{"id":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.internet_gateway.aws_eip.main[0]","module_address":"module.internet_gateway","mode":"managed","type":"aws_eip","name":"main","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-us-east-1a"},"tags_all":{"Name":"demo-eip-us-east-1a"},"timeouts":null},"after_unknown":{"allocation_id":true,"arn":true,"association_id":true,"carrier_ip":true,"customer_owned_ip":true,"id":true,"instance":true,"network_border_group":true,"network_interface":true,"private_dns":true,"private_ip":true,"ptr_record":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{},"tags_all":{},"vpc":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.internet_gateway.aws_eip.main[1]","module_address":"module.internet_gateway","mode":"managed","type":"aws_eip","name":"main","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-us-east-1b"},"tags_all":{"Name":"demo-eip-us-east-1b"},"timeouts":null},"after_unknown":{"allocation_id":true,"arn":true,"association_id":true,"carrier_ip":true,"customer_owned_ip":true,"id":true,"instance":true,"network_border_group":true,"network_interface":true,"private_dns":true,"private_ip":true,"ptr_record":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{},"tags_all":{},"vpc":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.internet_gateway.aws_internet_gateway.main","module_address":"module.internet_gateway","mode":"managed","type":"aws_internet_gateway","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.log_group.aws_cloudwatch_log_group.this","module_address":"module.log_group","mode":"managed","type":"aws_cloudwatch_log_group","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"kms_key_id":null,"retention_in_days":1,"skip_destroy":false,"tags":null},"after_unknown":{"arn":true,"id":true,"log_group_class":true,"name":true,"name_prefix":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"module.log_group.aws_cloudwatch_log_stream.this","module_address":"module.log_group","mode":"managed","type":"aws_cloudwatch_log_stream","name":"this","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"arn":true,"id":true,"log_group_name":true,"name":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.nat_gateway.aws_eip.nat","module_address":"module.nat_gateway","mode":"managed","type":"aws_eip","name":"nat","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"address":null,"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"domain":"vpc","tags":{"Name":"demo-eip-nat"},"tags_all":{"Name":"demo-eip-nat"},"timeouts":null},"after_unknown":{"allocation_id":true,"arn":true,"association_id":true,"carrier_ip":true,"customer_owned_ip":true,"id":true,"instance":true,"network_border_group":true,"network_interface":true,"private_dns":true,"private_ip":true,"ptr_record":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{},"tags_all":{},"vpc":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.nat_gateway.aws_nat_gateway.main","module_address":"module.nat_gateway","mode":"managed","type":"aws_nat_gateway","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"connectivity_type":"public","secondary_allocation_ids":null,"tags":{"Name":"demo-nat-gw"},"tags_all":{"Name":"demo-nat-gw"},"timeouts":null},"after_unknown":{"allocation_id":true,"association_id":true,"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"secondary_private_ip_address_count":true,"secondary_private_ip_addresses":true,"subnet_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"secondary_private_ip_addresses":[],"tags":{},"tags_all":{}}}},{"address":"module.route_table.aws_route.private_nat_gateway[0]","module_address":"module.route_table","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route.private_nat_gateway[1]","module_address":"module.route_table","mode":"managed","type":"aws_route","name":"private_nat_gateway","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"gateway_id":null,"local_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route.public_internet_gateway","module_address":"module.route_table","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"carrier_gateway_id":null,"core_network_arn":null,"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"destination_prefix_list_id":null,"egress_only_gateway_id":null,"local_gateway_id":null,"nat_gateway_id":null,"timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route_table.private[0]","module_address":"module.route_table","mode":"managed","type":"aws_route_table","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"demo-private-rt-1"},"tags_all":{"Name":"demo-private-rt-1"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.route_table.aws_route_table.private[1]","module_address":"module.route_table","mode":"managed","type":"aws_route_table","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"demo-private-rt-2"},"tags_all":{"Name":"demo-private-rt-2"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.route_table.aws_route_table.public","module_address":"module.route_table","mode":"managed","type":"aws_route_table","name":"public","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"demo-public-rt"},"tags_all":{"Name":"demo-public-rt"},"timeouts":null},"after_unknown":{"arn":true,"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"tags_all":{},"vpc_id":true},"before_sensitive":false,"after_sensitive":{"propagating_vgws":[],"route":[],"tags":{},"tags_all":{}}}},{"address":"module.route_table.aws_route_table_association.private[0]","module_address":"module.route_table","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route_table_association.private[1]","module_address":"module.route_table","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route_table_association.public[0]","module_address":"module.route_table","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.route_table.aws_route_table_association.public[1]","module_address":"module.route_table","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"timeouts":null},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"module.vpc.aws_subnet.private[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.0.2.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.private[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.0.3.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":false,"outpost_arn":null,"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.public[0]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.0.0.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_subnet.public[1]","module_address":"module.vpc","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.0.1.0/24","customer_owned_ipv4_pool":null,"enable_dns64":false,"enable_lni_at_device_index":null,"enable_resource_name_dns_a_record_on_launch":false,"enable_resource_name_dns_aaaa_record_on_launch":false,"ipv6_cidr_block":null,"ipv6_native":false,"map_customer_owned_ip_on_launch":null,"map_public_ip_on_launch":true,"outpost_arn":null,"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"private_dns_hostname_type_on_launch":true,"tags":true,"tags_all":true,"vpc_id":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"module.vpc.aws_vpc.main","module_address":"module.vpc","mode":"managed","type":"aws_vpc","name":"main","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assign_generated_ipv6_cidr_block":null,"cidr_block":"10.0.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","ipv4_ipam_pool_id":null,"ipv4_netmask_length":null,"ipv6_ipam_pool_id":null,"ipv6_netmask_length":null},"after_unknown":{"arn":true,"default_network_acl_id":true,"default_route_table_id":true,"default_security_group_id":true,"dhcp_options_id":true,"enable_network_address_usage_metrics":true,"id":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_network_border_group":true,"main_route_table_id":true,"owner_id":true,"tags":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}}],"output_changes":{"full_access_policy_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"instance_ips":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"key_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"selected_ecs_optimized_ami_id":{"actions":["create"],"before":null,"after":"ami-0405a351efe9c1ee0","after_unknown":false,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.9.6","values":{"outputs":{"selected_ecs_optimized_ami_id":{"sensitive":false,"value":"ami-0405a351efe9c1ee0","type":"string"}},"root_module":{"resources":[{"address":"data.aws_ami.ecs_optimized","mode":"data","type":"aws_ami","name":"ecs_optimized","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"architecture":"x86_64","arn":"arn:aws:ec2:us-east-1::image/ami-0405a351efe9c1ee0","block_device_mappings":[{"device_name":"/dev/xvda","ebs":{"delete_on_termination":"true","encrypted":"false","iops":"0","snapshot_id":"snap-0a8e4fde0a7acf538","throughput":"0","volume_size":"30","volume_type":"gp2"},"no_device":"","virtual_name":""}],"boot_mode":"","creation_date":"2024-10-10T21:40:52.000Z","deprecation_time":"2026-10-10T21:40:52.000Z","description":"Amazon Linux AMI 2.0.20241010 x86_64 ECS HVM GP2","ena_support":true,"executable_users":null,"filter":[{"name":"name","values":["amzn2-ami-ecs-hvm-*-x86_64-ebs"]},{"name":"owner-id","values":["591542846629"]},{"name":"virtualization-type","values":["hvm"]}],"hypervisor":"xen","id":"ami-0405a351efe9c1ee0","image_id":"ami-0405a351efe9c1ee0","image_location":"amazon/amzn2-ami-ecs-hvm-2.0.20241010-x86_64-ebs","image_owner_alias":"amazon","image_type":"machine","imds_support":"","include_deprecated":false,"kernel_id":"","most_recent":true,"name":"amzn2-ami-ecs-hvm-2.0.20241010-x86_64-ebs","name_regex":null,"owner_id":"591542846629","owners":["591542846629"],"platform":"","platform_details":"Linux/UNIX","product_codes":[],"public":true,"ramdisk_id":"","root_device_name":"/dev/xvda","root_device_type":"ebs","root_snapshot_id":"snap-0a8e4fde0a7acf538","sriov_net_support":"simple","state":"available","state_reason":{"code":"UNSET","message":"UNSET"},"tags":{},"timeouts":null,"tpm_support":"","usage_operation":"RunInstances","virtualization_type":"hvm"},"sensitive_values":{"block_device_mappings":[{"ebs":{}}],"filter":[{"values":[false]},{"values":[false]},{"values":[false]}],"owners":[false],"product_codes":[],"state_reason":{},"tags":{}}},{"address":"data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"all_availability_zones":null,"exclude_names":null,"exclude_zone_ids":null,"filter":null,"group_names":["us-east-1"],"id":"us-east-1","names":["us-east-1a","us-east-1b","us-east-1c","us-east-1d","us-east-1e","us-east-1f"],"state":"available","timeouts":null,"zone_ids":["use1-az2","use1-az4","use1-az6","use1-az1","use1-az3","use1-az5"]},"sensitive_values":{"group_names":[false],"names":[false,false,false,false,false,false],"zone_ids":[false,false,false,false,false,false]}}],"child_modules":[{"resources":[{"address":"module.ecs_launch_template.data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"US East (N. Virginia)","endpoint":"ec2.us-east-1.amazonaws.com","id":"us-east-1","name":"us-east-1"},"sensitive_values":{}}],"address":"module.ecs_launch_template"},{"resources":[{"address":"module.ecs_node_role.data.aws_iam_policy_document.ecs_node_doc","mode":"data","type":"aws_iam_policy_document","name":"ecs_node_doc","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"1895348101","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": [\n          \"ecs-tasks.amazonaws.com\",\n          \"ec2.amazonaws.com\"\n        ]\n      }\n    }\n  ]\n}","minified_json":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"sts:AssumeRole\",\"Principal\":{\"Service\":[\"ecs-tasks.amazonaws.com\",\"ec2.amazonaws.com\"]}}]}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["sts:AssumeRole"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["ec2.amazonaws.com","ecs-tasks.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false,false]}],"resources":[]}]}},{"address":"module.ecs_node_role.data.aws_iam_policy_document.full_access","mode":"data","type":"aws_iam_policy_document","name":"full_access","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"301127969","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:*\",\n        \"ecs:*\",\n        \"ec2:*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}","minified_json":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"logs:*\",\"ecs:*\",\"ec2:*\"],\"Resource\":\"*\"}]}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["ec2:*","ecs:*","logs:*"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[],"resources":["*"],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false,false,false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[],"resources":[false]}]}}],"address":"module.ecs_node_role"}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"~\u003e 5.8","expressions":{"max_retries":{"constant_value":3},"region":{"constant_value":"us-east-1"},"retry_mode":{"constant_value":"standard"}}},"local":{"name":"local","full_name":"registry.terraform.io/hashicorp/local"},"null":{"name":"null","full_name":"registry.terraform.io/hashicorp/null"},"random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","version_constraint":"~\u003e 3.6.2"},"tls":{"name":"tls","full_name":"registry.terraform.io/hashicorp/tls"}},"root_module":{"outputs":{"full_access_policy_arn":{"expression":{"references":["module.ecs_node_role.full_access_policy_arn","module.ecs_node_role"]},"description":"ARN of the full access policy"},"instance_ips":{"expression":{"references":["data.aws_instances.ecs_instances.public_ips","data.aws_instances.ecs_instances"]},"description":"Public IPs of the EC2 instances in the ECS cluster"},"key_name":{"expression":{"references":["aws_key_pair.generated_key.key_name","aws_key_pair.generated_key"]},"description":"The name of the generated key pair for SSH access"},"selected_ecs_optimized_ami_id":{"expression":{"references":["data.aws_ami.ecs_optimized.id","data.aws_ami.ecs_optimized"]},"description":"The ID of the ECS-optimized AMI that was selected"}},"resources":[{"address":"aws_key_pair.generated_key","mode":"managed","type":"aws_key_pair","name":"generated_key","provider_config_key":"aws","expressions":{"key_name":{"references":["random_id.unique.hex","random_id.unique"]},"public_key":{"references":["tls_private_key.ssh_key.public_key_openssh","tls_private_key.ssh_key"]}},"schema_version":1},{"address":"local_file.private_key","mode":"managed","type":"local_file","name":"private_key","provider_config_key":"local","expressions":{"content":{"references":["tls_private_key.ssh_key.private_key_pem","tls_private_key.ssh_key"]},"file_permission":{"constant_value":"0600"},"filename":{"references":["path.cwd"]}},"schema_version":0},{"address":"null_resource.docker_login","mode":"managed","type":"null_resource","name":"docker_login","provider_config_key":"null","provisioners":[{"type":"local-exec","expressions":{"command":{"references":["local.dockerhub_credentials.username","local.dockerhub_credentials","local.dockerhub_credentials.password","local.dockerhub_credentials"]}}}],"schema_version":0},{"address":"null_resource.drain_ecs_cluster","mode":"managed","type":"null_resource","name":"drain_ecs_cluster","provider_config_key":"null","provisioners":[{"type":"local-exec","expressions":{"command":{"references":["self.triggers.cluster_name","self.triggers","self","self.triggers.cluster_name","self.triggers","self","self.triggers.cluster_name","self.triggers","self","self.triggers.cluster_name","self.triggers","self"]}}}],"expressions":{"triggers":{"references":["module.ecs_cluster.cluster_name","module.ecs_cluster"]}},"schema_version":0,"depends_on":["module.ecs_service"]},{"address":"random_id.unique","mode":"managed","type":"random_id","name":"unique","provider_config_key":"random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0},{"address":"tls_private_key.ssh_key","mode":"managed","type":"tls_private_key","name":"ssh_key","provider_config_key":"tls","expressions":{"algorithm":{"constant_value":"RSA"},"rsa_bits":{"constant_value":4096}},"schema_version":1},{"address":"data.aws_ami.ecs_optimized","mode":"data","type":"aws_ami","name":"ecs_optimized","provider_config_key":"aws","expressions":{"filter":[{"name":{"constant_value":"name"},"values":{"constant_value":["amzn2-ami-ecs-hvm-*-x86_64-ebs"]}},{"name":{"constant_value":"owner-id"},"values":{"constant_value":["591542846629"]}},{"name":{"constant_value":"virtualization-type"},"values":{"constant_value":["hvm"]}}],"most_recent":{"constant_value":true},"owners":{"constant_value":["591542846629"]}},"schema_version":0},{"address":"data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_config_key":"aws","expressions":{"state":{"constant_value":"available"}},"schema_version":0},{"address":"data.aws_instances.ecs_instances","mode":"data","type":"aws_instances","name":"ecs_instances","provider_config_key":"aws","expressions":{"filter":[{"name":{"constant_value":"instance-state-name"},"values":{"constant_value":["running"]}},{"name":{"constant_value":"tag:aws:autoscaling:groupName"},"values":{"references":["module.ecs_asg.autoscaling_group_name","module.ecs_asg"]}}]},"schema_version":0,"depends_on":["module.ecs_asg"]}],"module_calls":{"alb":{"source":"./modules/alb","expressions":{"alb_name":{"references":["random_id.unique.hex","random_id.unique"]},"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"nginx_port":{"references":["module.ecs_task_definition.nginx_port","module.ecs_task_definition"]},"subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"alb_dns_name":{"expression":{"references":["aws_lb.main.dns_name","aws_lb.main"]},"description":"The DNS name of the load balancer"},"alb_name":{"expression":{"references":["aws_lb.main.name","aws_lb.main"]},"description":"The DNS name of the load balancer"},"listener_arn":{"expression":{"references":["aws_lb_listener.http.arn","aws_lb_listener.http"]},"description":"The ARN of the ALB listener"},"security_group_id":{"expression":{"references":["aws_security_group.http.id","aws_security_group.http"]}},"target_group_arn":{"expression":{"references":["aws_lb_target_group.app.arn","aws_lb_target_group.app"]},"description":"The ARN of the created target group"}},"resources":[{"address":"aws_lb.main","mode":"managed","type":"aws_lb","name":"main","provider_config_key":"aws","expressions":{"enable_deletion_protection":{"constant_value":false},"load_balancer_type":{"constant_value":"application"},"name":{"constant_value":"demo-alb"},"security_groups":{"references":["aws_security_group.http.id","aws_security_group.http"]},"subnets":{"references":["var.subnet_ids"]},"tags":{"references":["var.alb_name"]}},"schema_version":0},{"address":"aws_lb_listener.http","mode":"managed","type":"aws_lb_listener","name":"http","provider_config_key":"aws","expressions":{"default_action":[{"target_group_arn":{"references":["aws_lb_target_group.app.arn","aws_lb_target_group.app"]},"type":{"constant_value":"forward"}}],"load_balancer_arn":{"references":["aws_lb.main.arn","aws_lb.main"]},"port":{"constant_value":80},"protocol":{"constant_value":"HTTP"}},"schema_version":0},{"address":"aws_lb_target_group.app","mode":"managed","type":"aws_lb_target_group","name":"app","provider_config_key":"aws","expressions":{"health_check":[{"healthy_threshold":{"constant_value":2},"interval":{"constant_value":60},"matcher":{"constant_value":"200,301,302"},"path":{"constant_value":"/"},"timeout":{"constant_value":30},"unhealthy_threshold":{"constant_value":10}}],"name":{"references":["var.name_prefix","random_id.target_group_suffix.hex","random_id.target_group_suffix"]},"port":{"references":["var.nginx_port"]},"protocol":{"constant_value":"HTTP"},"stickiness":[{"cookie_duration":{"constant_value":86400},"enabled":{"constant_value":true},"type":{"constant_value":"lb_cookie"}}],"target_type":{"constant_value":"instance"},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":0},{"address":"aws_security_group.http","mode":"managed","type":"aws_security_group","name":"http","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow all HTTP/HTTPS traffic from public"},"egress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":null,"from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_groups":null,"self":null,"to_port":0}]},"name_prefix":{"constant_value":"http-sg-"},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1},{"address":"random_id.target_group_suffix","mode":"managed","type":"random_id","name":"target_group_suffix","provider_config_key":"random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0}],"variables":{"alb_name":{"description":"Name of the Application Load Balancer"},"name_prefix":{"description":"Prefix to use for resource names"},"nginx_port":{"description":"Port number for Nginx container"},"subnet_ids":{"description":"List of subnet IDs where the ALB will be placed"},"vpc_id":{"description":"ID of the VPC where resources will be created"}}}},"ecs_asg":{"source":"./modules/autosacling_group","expressions":{"desired_capacity":{"constant_value":1},"instance_name":{"references":["random_id.unique.hex","random_id.unique"]},"launch_template_id":{"references":["module.ecs_launch_template.launch_template_id","module.ecs_launch_template"]},"max_size":{"constant_value":2},"min_size":{"constant_value":1},"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]}},"module":{"outputs":{"asg_arn":{"expression":{"references":["aws_autoscaling_group.ecs.arn","aws_autoscaling_group.ecs"]},"description":"The ARN of the Auto Scaling Group"},"asg_id":{"expression":{"references":["aws_autoscaling_group.ecs.id","aws_autoscaling_group.ecs"]}},"autoscaling_group_name":{"expression":{"references":["aws_autoscaling_group.ecs.name","aws_autoscaling_group.ecs"]},"description":"The name of the Auto Scaling Group"}},"resources":[{"address":"aws_autoscaling_group.ecs","mode":"managed","type":"aws_autoscaling_group","name":"ecs","provider_config_key":"aws","expressions":{"desired_capacity":{"constant_value":1},"health_check_grace_period":{"constant_value":0},"health_check_type":{"constant_value":"EC2"},"launch_template":[{"id":{"references":["var.launch_template_id"]},"version":{"constant_value":"$Latest"}}],"max_size":{"constant_value":2},"min_size":{"constant_value":1},"name":{"references":["var.name_prefix"]},"protect_from_scale_in":{"constant_value":false},"tag":[{"key":{"constant_value":"Name"},"propagate_at_launch":{"constant_value":true},"value":{"references":["var.instance_name"]}},{"key":{"constant_value":"AmazonECSManaged"},"propagate_at_launch":{"constant_value":true},"value":{"constant_value":"true"}}],"vpc_zone_identifier":{"references":["var.subnet_ids"]}},"schema_version":1}],"variables":{"desired_capacity":{"default":1,"description":"Desired capacity of the Auto Scaling Group"},"enabled":{"default":true,"description":"Whether to create the Auto Scaling Group"},"instance_name":{"description":"Name to give the EC2 instance"},"launch_template_id":{"description":"ID of the launch template to use"},"max_size":{"default":1,"description":"Maximum size of the Auto Scaling Group"},"min_size":{"default":1,"description":"Minimum size of the Auto Scaling Group"},"name_prefix":{"description":"Prefix to use for resource names"},"subnet_ids":{"description":"List of subnet IDs to launch resources in"}}}},"ecs_capacity_provider":{"source":"./modules/ecs_capacity_provider","expressions":{"asg_arn":{"references":["module.ecs_asg.asg_arn","module.ecs_asg"]},"base_capacity":{"constant_value":1},"capacity_provider_name":{"references":["random_id.unique.hex","random_id.unique"]},"cluster_name":{"references":["module.ecs_cluster.cluster_name","module.ecs_cluster"]},"max_scaling_step_size":{"constant_value":1},"min_scaling_step_size":{"constant_value":1},"target_capacity":{"constant_value":100},"weight":{"constant_value":100}},"module":{"outputs":{"capacity_provider_name":{"expression":{"references":["aws_ecs_capacity_provider.main.name","aws_ecs_capacity_provider.main"]},"description":"Name of the created ECS capacity provider"},"cluster_capacity_providers":{"expression":{"references":["aws_ecs_cluster_capacity_providers.main.capacity_providers","aws_ecs_cluster_capacity_providers.main"]}}},"resources":[{"address":"aws_ecs_capacity_provider.main","mode":"managed","type":"aws_ecs_capacity_provider","name":"main","provider_config_key":"aws","expressions":{"auto_scaling_group_provider":[{"auto_scaling_group_arn":{"references":["var.asg_arn"]},"managed_scaling":[{"maximum_scaling_step_size":{"references":["var.max_scaling_step_size"]},"minimum_scaling_step_size":{"references":["var.min_scaling_step_size"]},"status":{"constant_value":"ENABLED"},"target_capacity":{"references":["var.target_capacity"]}}],"managed_termination_protection":{"constant_value":"DISABLED"}}],"name":{"references":["var.capacity_provider_name"]}},"schema_version":0},{"address":"aws_ecs_cluster_capacity_providers.main","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_config_key":"aws","expressions":{"capacity_providers":{"references":["aws_ecs_capacity_provider.main.name","aws_ecs_capacity_provider.main"]},"cluster_name":{"references":["var.cluster_name"]},"default_capacity_provider_strategy":[{"base":{"references":["var.base_capacity"]},"capacity_provider":{"references":["aws_ecs_capacity_provider.main.name","aws_ecs_capacity_provider.main"]},"weight":{"references":["var.weight"]}}]},"schema_version":0}],"variables":{"asg_arn":{"description":"ARN of the Auto Scaling Group"},"base_capacity":{"description":"The base capacity for the capacity provider."},"capacity_provider_name":{"description":"Name of the ECS capacity provider"},"cluster_name":{"description":"Name of the ECS cluster"},"max_scaling_step_size":{"description":"The maximum scaling step size for the capacity provider."},"min_scaling_step_size":{"description":"The minimum scaling step size for the capacity provider."},"target_capacity":{"description":"The target capacity for the capacity provider."},"weight":{"description":"The weight of the capacity provider."}}}},"ecs_cluster":{"source":"./modules/ecs_cluster","expressions":{"capacity_provider_name":{"references":["module.ecs_capacity_provider.capacity_provider_name","module.ecs_capacity_provider"]},"cluster_name":{"references":["random_id.unique.hex","random_id.unique"]},"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]}},"module":{"outputs":{"capacity_provider_name":{"expression":{"references":["var.capacity_provider_name"]}},"cluster_id":{"expression":{"references":["aws_ecs_cluster.main.id","aws_ecs_cluster.main"]},"description":"The ID of the ECS cluster"},"cluster_name":{"expression":{"references":["aws_ecs_cluster.main.name","aws_ecs_cluster.main"]},"description":"The name of the ECS cluster"},"ecs_cluster_id":{"expression":{"references":["aws_ecs_cluster.main.name","aws_ecs_cluster.main"]},"description":"The name of the ECS cluster"}},"resources":[{"address":"aws_ecs_cluster.main","mode":"managed","type":"aws_ecs_cluster","name":"main","provider_config_key":"aws","expressions":{"name":{"references":["var.cluster_name"]}},"schema_version":0},{"address":"aws_ecs_cluster_capacity_providers.main","mode":"managed","type":"aws_ecs_cluster_capacity_providers","name":"main","provider_config_key":"aws","expressions":{"capacity_providers":{"references":["var.capacity_provider_name"]},"cluster_name":{"references":["aws_ecs_cluster.main.name","aws_ecs_cluster.main"]},"default_capacity_provider_strategy":[{"base":{"constant_value":1},"capacity_provider":{"references":["var.capacity_provider_name"]},"weight":{"constant_value":100}}]},"schema_version":0}],"variables":{"capacity_provider_name":{"default":"","description":"Name of the capacity provider to associate with the cluster"},"capacity_providers":{"default":[],"description":"List of short names of one or more capacity providers to associate with the cluster"},"cluster_name":{"description":"Name of the ECS cluster"},"default_capacity_provider_strategy":{"default":[],"description":"The capacity provider strategy to use by default for the cluster"},"name_prefix":{"description":"Prefix for the cluster name"},"use_existing_capacity_provider":{"default":false,"description":"Whether to use an existing capacity provider"}}},"depends_on":["module.vpc","module.route_table"]},"ecs_launch_template":{"source":"./modules/ecs_launch_template","expressions":{"ami_id":{"references":["data.aws_ami.ecs_optimized.id","data.aws_ami.ecs_optimized"]},"cluster_name":{"references":["module.ecs_cluster.cluster_name","module.ecs_cluster"]},"dockerhub_password":{"references":["local.dockerhub_credentials.password","local.dockerhub_credentials"]},"dockerhub_username":{"references":["local.dockerhub_credentials.username","local.dockerhub_credentials"]},"iam_instance_profile_arn":{"references":["module.ecs_node_role.ecs_instance_profile_arn","module.ecs_node_role"]},"instance_type":{"constant_value":"t2.micro"},"key_name":{"references":["aws_key_pair.generated_key.key_name","aws_key_pair.generated_key"]},"log_group_name":{"references":["module.log_group.cloudwatch_log_group_name","module.log_group"]},"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"security_group_id":{"references":["module.ecs_node_sg.security_group_id","module.ecs_node_sg"]}},"module":{"outputs":{"ec2_log_stream_name_pattern":{"expression":{"constant_value":"{instance_id}/ecs-agent"},"description":"The pattern used for EC2 instance log stream names"},"launch_template_id":{"expression":{"references":["aws_launch_template.ecs_ec2.id","aws_launch_template.ecs_ec2"]}}},"resources":[{"address":"aws_launch_template.ecs_ec2","mode":"managed","type":"aws_launch_template","name":"ecs_ec2","provider_config_key":"aws","expressions":{"iam_instance_profile":[{"arn":{"references":["var.iam_instance_profile_arn"]}}],"image_id":{"references":["var.ami_id"]},"instance_type":{"references":["var.instance_type"]},"key_name":{"references":["var.key_name"]},"name_prefix":{"references":["var.name_prefix"]},"network_interfaces":[{"associate_public_ip_address":{"constant_value":true},"security_groups":{"references":["var.security_group_id"]}}],"user_data":{"references":["path.module","var.cluster_name","var.log_group_name","var.log_stream_name","data.aws_region.current.name","data.aws_region.current","var.dockerhub_username","var.dockerhub_password"]}},"schema_version":0},{"address":"data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_config_key":"aws","schema_version":0}],"variables":{"additional_user_data":{"default":"","description":"Additional user data script to run on instance launch"},"ami_id":{"description":"The AMI ID to use for the launch template."},"cluster_name":{"description":"The name of the ECS cluster"},"dockerhub_password":{"description":"Docker Hub password","sensitive":true},"dockerhub_username":{"description":"Docker Hub username"},"iam_instance_profile_arn":{"description":"The ARN of the IAM instance profile to associate with the launch template."},"instance_type":{"description":"The instance type to use for the launch template."},"key_name":{"description":"The name of the key pair to use for SSH access"},"log_group_name":{"description":"The name of the CloudWatch log group"},"log_stream_name":{"default":"ecs","description":"The prefix for the CloudWatch log stream"},"name_prefix":{"description":"Prefix for the launch template name."},"root_volume_size":{"default":30,"description":"The size of the root volume in GB"},"root_volume_type":{"default":"gp3","description":"The type of the root volume (gp2, gp3, io1, etc.)"},"security_group_id":{"description":"The security group ID to associate with the launch template."},"tags":{"default":{},"description":"A map of tags to add to the launch template"}}}},"ecs_node_role":{"source":"./modules/ecs_node_role","expressions":{"profile_name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"role_name_prefix":{"references":["random_id.unique.hex","random_id.unique"]}},"module":{"outputs":{"ecs_exec_role_arn":{"expression":{"references":["aws_iam_role.ecs_exec_role.arn","aws_iam_role.ecs_exec_role"]},"description":"ARN of the ECS task execution IAM role"},"ecs_instance_profile_arn":{"expression":{"references":["aws_iam_instance_profile.ecs_node.arn","aws_iam_instance_profile.ecs_node"]},"description":"ARN of the ECS instance profile"},"ecs_node_role_arn":{"expression":{"references":["aws_iam_role.ecs_node_role.arn","aws_iam_role.ecs_node_role"]},"description":"ARN of the ECS node IAM role"},"full_access_policy_arn":{"expression":{"references":["aws_iam_policy.full_access.arn","aws_iam_policy.full_access"]},"description":"ARN of the full access policy"}},"resources":[{"address":"aws_iam_instance_profile.ecs_node","mode":"managed","type":"aws_iam_instance_profile","name":"ecs_node","provider_config_key":"aws","expressions":{"name_prefix":{"references":["var.profile_name_prefix"]},"path":{"constant_value":"/ecs/instance/"},"role":{"references":["aws_iam_role.ecs_node_role.name","aws_iam_role.ecs_node_role"]}},"schema_version":0},{"address":"aws_iam_policy.full_access","mode":"managed","type":"aws_iam_policy","name":"full_access","provider_config_key":"aws","expressions":{"description":{"constant_value":"Full access to EC2, ECS, and CloudWatch Logs"},"name":{"references":["var.role_name_prefix"]},"path":{"constant_value":"/"},"policy":{"references":["data.aws_iam_policy_document.full_access.json","data.aws_iam_policy_document.full_access"]}},"schema_version":0},{"address":"aws_iam_role.ecs_exec_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name_prefix":{"references":["var.role_name_prefix"]}},"schema_version":0},{"address":"aws_iam_role.ecs_node_role","mode":"managed","type":"aws_iam_role","name":"ecs_node_role","provider_config_key":"aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.ecs_node_doc.json","data.aws_iam_policy_document.ecs_node_doc"]},"name_prefix":{"references":["var.role_name_prefix"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ecs_cloudwatch_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_cloudwatch_policy","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/CloudWatchLogsFullAccess"},"role":{"references":["aws_iam_role.ecs_node_role.name","aws_iam_role.ecs_node_role"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ecs_exec_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"role":{"references":["aws_iam_role.ecs_exec_role.name","aws_iam_role.ecs_exec_role"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ecs_node_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_node_role_policy","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"},"role":{"references":["aws_iam_role.ecs_node_role.name","aws_iam_role.ecs_node_role"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.full_access_exec","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_exec","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.full_access.arn","aws_iam_policy.full_access"]},"role":{"references":["aws_iam_role.ecs_exec_role.name","aws_iam_role.ecs_exec_role"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.full_access_node","mode":"managed","type":"aws_iam_role_policy_attachment","name":"full_access_node","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.full_access.arn","aws_iam_policy.full_access"]},"role":{"references":["aws_iam_role.ecs_node_role.name","aws_iam_role.ecs_node_role"]}},"schema_version":0},{"address":"data.aws_iam_policy_document.ecs_node_doc","mode":"data","type":"aws_iam_policy_document","name":"ecs_node_doc","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["ec2.amazonaws.com","ecs-tasks.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0},{"address":"data.aws_iam_policy_document.full_access","mode":"data","type":"aws_iam_policy_document","name":"full_access","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["ec2:*","ecs:*","logs:*"]},"effect":{"constant_value":"Allow"},"resources":{"constant_value":["*"]}}]},"schema_version":0}],"variables":{"additional_policies":{"default":[],"description":"List of additional policy ARNs to attach to the ECS node role."},"enable_full_access":{"default":true,"description":"Whether to enable full access for the ECS node role."},"profile_name_prefix":{"description":"Prefix for the ECS node instance profile name."},"role_name_prefix":{"description":"Prefix for the ECS node role name."},"tags":{"default":{},"description":"A map of tags to add to all resources"}}}},"ecs_node_sg":{"source":"./modules/ecs_node_sg","expressions":{"alb_security_group_id":{"references":["module.alb.security_group_id","module.alb"]},"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"nginx_port":{"references":["module.ecs_task_definition.nginx_port","module.ecs_task_definition"]},"node_port":{"references":["module.ecs_task_definition.node_port","module.ecs_task_definition"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"security_group_arn":{"expression":{"references":["aws_security_group.ecs_node_sg.arn","aws_security_group.ecs_node_sg"]},"description":"ARN of the ECS node security group."},"security_group_id":{"expression":{"references":["aws_security_group.ecs_node_sg.id","aws_security_group.ecs_node_sg"]},"description":"ID of the ECS node security group."}},"resources":[{"address":"aws_security_group.ecs_node_sg","mode":"managed","type":"aws_security_group","name":"ecs_node_sg","provider_config_key":"aws","expressions":{"description":{"constant_value":"Security group for ECS nodes"},"egress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":"Allow all outbound traffic","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_groups":null,"self":null,"to_port":0}]},"ingress":{"references":["var.alb_security_group_id"]},"name_prefix":{"references":["var.name_prefix"]},"tags":{"references":["var.name_prefix"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1},{"address":"aws_security_group_rule.allow_all_vpc","mode":"managed","type":"aws_security_group_rule","name":"allow_all_vpc","provider_config_key":"aws","expressions":{"cidr_blocks":{"references":["data.aws_vpc.selected.cidr_block","data.aws_vpc.selected"]},"from_port":{"constant_value":0},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.ecs_node_sg.id","aws_security_group.ecs_node_sg"]},"to_port":{"constant_value":65535},"type":{"constant_value":"ingress"}},"schema_version":2},{"address":"aws_security_group_rule.allow_container_ports","mode":"managed","type":"aws_security_group_rule","name":"allow_container_ports","provider_config_key":"aws","expressions":{"cidr_blocks":{"constant_value":["0.0.0.0/0"]},"description":{"constant_value":"Allow inbound traffic on container ports"},"from_port":{"constant_value":0},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.ecs_node_sg.id","aws_security_group.ecs_node_sg"]},"to_port":{"constant_value":65535},"type":{"constant_value":"ingress"}},"schema_version":2},{"address":"data.aws_vpc.selected","mode":"data","type":"aws_vpc","name":"selected","provider_config_key":"aws","expressions":{"id":{"references":["var.vpc_id"]}},"schema_version":0}],"variables":{"alb_security_group_id":{"description":"The ID of the ALB security group"},"name_prefix":{"description":"Prefix for the ECS node security group name."},"nginx_port":{"description":"Port number for Nginx container"},"node_port":{"description":"Port number for Node.js container"},"vpc_id":{"description":"ID of the VPC where the security group will be created."}}}},"ecs_service":{"source":"./modules/ecs_service","expressions":{"alb_listener_arn":{"references":["module.alb.listener_arn","module.alb"]},"capacity_provider_name":{"references":["module.ecs_capacity_provider.capacity_provider_name","module.ecs_capacity_provider"]},"cloudwatch_log_group_name":{"references":["module.log_group.cloudwatch_log_group_name","module.log_group"]},"cluster_id":{"references":["module.ecs_cluster.cluster_id","module.ecs_cluster"]},"container_name":{"references":["module.ecs_task_definition.container_name","module.ecs_task_definition"]},"desired_count":{"constant_value":2},"ecs_cluster_id":{"references":["module.ecs_cluster.ecs_cluster_id","module.ecs_cluster"]},"log_group_arn":{"references":["module.log_group.cloudwatch_log_group_arn","module.log_group"]},"name_prefix":{"references":["var.name_prefix"]},"nginx_port":{"references":["module.ecs_task_definition.nginx_port","module.ecs_task_definition"]},"public_subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"security_group_id":{"references":["module.ecs_node_sg.security_group_id","module.ecs_node_sg"]},"service_name":{"references":["var.name_prefix","random_id.unique.hex","random_id.unique"]},"subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"target_group_arn":{"references":["module.alb.target_group_arn","module.alb"]},"task_definition_arn":{"references":["module.ecs_task_definition.task_definition_arn","module.ecs_task_definition"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"security_group_id":{"expression":{"references":["var.security_group_id"]}},"service_id":{"expression":{"references":["aws_ecs_service.app.id","aws_ecs_service.app"]}},"service_name":{"expression":{"references":["aws_ecs_service.app.name","aws_ecs_service.app"]}}},"resources":[{"address":"aws_ecs_service.app","mode":"managed","type":"aws_ecs_service","name":"app","provider_config_key":"aws","expressions":{"cluster":{"references":["var.cluster_id"]},"deployment_circuit_breaker":[{"enable":{"constant_value":true},"rollback":{"constant_value":true}}],"deployment_controller":[{"type":{"constant_value":"ECS"}}],"desired_count":{"references":["var.desired_count"]},"load_balancer":[{"container_name":{"references":["var.container_name"]},"container_port":{"references":["var.nginx_port"]},"target_group_arn":{"references":["var.target_group_arn"]}}],"name":{"references":["var.service_name"]},"ordered_placement_strategy":[{"field":{"constant_value":"instanceId"},"type":{"constant_value":"spread"}}],"placement_constraints":[{"type":{"constant_value":"distinctInstance"}}],"task_definition":{"references":["var.task_definition_arn"]}},"schema_version":1,"depends_on":["var.alb_listener_arn"]}],"variables":{"alb_listener_arn":{"description":"ARN of the ALB listener"},"capacity_provider_name":{"description":"Name of the capacity provider"},"cloudwatch_log_group_name":{"description":"Name of the CloudWatch log group"},"cluster_id":{"description":"ID of the ECS cluster"},"container_name":{"description":"Name of the container"},"desired_count":{"description":"Desired number of tasks"},"ecs_cluster_id":{"description":"ID of the ECS cluster"},"log_group_arn":{"description":"ARN of the CloudWatch log group"},"name_prefix":{"description":"Prefix for the service name"},"network_mode":{"default":"bridge","description":"Network mode of the task definition (awsvpc, bridge, host, or none)"},"nginx_port":{"description":"Port number for Nginx container"},"public_subnet_ids":{"description":"List of public subnet IDs"},"retention_in_days":{"default":1,"description":"Retention period for the CloudWatch Log Group (in days)"},"security_group_id":{"description":"ID of the security group for ECS tasks"},"service_name":{"description":"Name of the ECS service"},"subnet_ids":{"description":"List of subnet IDs"},"target_group_arn":{"description":"ARN of the target group"},"task_definition_arn":{"description":"ARN of the task definition"},"vpc_id":{"description":"ID of the VPC where the ECS tasks will run"}}},"depends_on":["module.ecs_capacity_provider"]},"ecs_service_auto_scaling":{"source":"./modules/ecs_service_auto_scaling","expressions":{"asg_arn":{"references":["module.ecs_asg.asg_arn","module.ecs_asg"]},"cluster_name":{"references":["module.ecs_cluster.cluster_name","module.ecs_cluster"]},"max_capacity":{"constant_value":5},"min_capacity":{"constant_value":2},"service_name":{"references":["module.ecs_service.service_name","module.ecs_service"]},"target_cpu_value":{"constant_value":80},"target_memory_value":{"constant_value":80}},"module":{"outputs":{"appautoscaling_target_max_capacity":{"expression":{"references":["aws_appautoscaling_target.ecs_target.max_capacity","aws_appautoscaling_target.ecs_target"]},"description":"The max capacity of the AppAutoscaling target"},"appautoscaling_target_min_capacity":{"expression":{"references":["aws_appautoscaling_target.ecs_target.min_capacity","aws_appautoscaling_target.ecs_target"]},"description":"The min capacity of the AppAutoscaling target"},"appautoscaling_target_resource_id":{"expression":{"references":["aws_appautoscaling_target.ecs_target.resource_id","aws_appautoscaling_target.ecs_target"]},"description":"The resource ID of the AppAutoscaling target"},"asg_arn":{"expression":{"references":["var.asg_arn"]},"description":"The ARN of the Auto Scaling Group"},"cpu_policy_name":{"expression":{"references":["aws_appautoscaling_policy.ecs_target_cpu.name","aws_appautoscaling_policy.ecs_target_cpu"]},"description":"Name of the CPU target tracking scaling policy"},"memory_policy_name":{"expression":{"references":["aws_appautoscaling_policy.ecs_target_memory.name","aws_appautoscaling_policy.ecs_target_memory"]},"description":"Name of the Memory target tracking scaling policy"}},"resources":[{"address":"aws_appautoscaling_policy.ecs_target_cpu","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_cpu","provider_config_key":"aws","expressions":{"name":{"constant_value":"application-scaling-policy-cpu"},"policy_type":{"constant_value":"TargetTrackingScaling"},"resource_id":{"references":["aws_appautoscaling_target.ecs_target.resource_id","aws_appautoscaling_target.ecs_target"]},"scalable_dimension":{"references":["aws_appautoscaling_target.ecs_target.scalable_dimension","aws_appautoscaling_target.ecs_target"]},"service_namespace":{"references":["aws_appautoscaling_target.ecs_target.service_namespace","aws_appautoscaling_target.ecs_target"]},"target_tracking_scaling_policy_configuration":[{"predefined_metric_specification":[{"predefined_metric_type":{"constant_value":"ECSServiceAverageCPUUtilization"}}],"scale_in_cooldown":{"constant_value":300},"scale_out_cooldown":{"constant_value":300},"target_value":{"references":["var.target_cpu_value"]}}]},"schema_version":0},{"address":"aws_appautoscaling_policy.ecs_target_memory","mode":"managed","type":"aws_appautoscaling_policy","name":"ecs_target_memory","provider_config_key":"aws","expressions":{"name":{"constant_value":"application-scaling-policy-memory"},"policy_type":{"constant_value":"TargetTrackingScaling"},"resource_id":{"references":["aws_appautoscaling_target.ecs_target.resource_id","aws_appautoscaling_target.ecs_target"]},"scalable_dimension":{"references":["aws_appautoscaling_target.ecs_target.scalable_dimension","aws_appautoscaling_target.ecs_target"]},"service_namespace":{"references":["aws_appautoscaling_target.ecs_target.service_namespace","aws_appautoscaling_target.ecs_target"]},"target_tracking_scaling_policy_configuration":[{"predefined_metric_specification":[{"predefined_metric_type":{"constant_value":"ECSServiceAverageMemoryUtilization"}}],"scale_in_cooldown":{"constant_value":300},"scale_out_cooldown":{"constant_value":300},"target_value":{"references":["var.target_memory_value"]}}]},"schema_version":0},{"address":"aws_appautoscaling_target.ecs_target","mode":"managed","type":"aws_appautoscaling_target","name":"ecs_target","provider_config_key":"aws","expressions":{"max_capacity":{"references":["var.max_capacity"]},"min_capacity":{"references":["var.min_capacity"]},"resource_id":{"references":["var.cluster_name","var.service_name"]},"scalable_dimension":{"constant_value":"ecs:service:DesiredCount"},"service_namespace":{"constant_value":"ecs"}},"schema_version":0}],"variables":{"asg_arn":{"description":"The ARN of the Auto Scaling Group"},"cluster_name":{"description":"Name of the ECS cluster"},"max_capacity":{"default":5,"description":"Maximum number of tasks"},"min_capacity":{"default":2,"description":"Minimum number of tasks"},"service_name":{"description":"Name of the ECS service"},"target_cpu_value":{"default":80,"description":"Target CPU utilization percentage"},"target_memory_value":{"default":80,"description":"Target Memory utilization percentage"}}},"depends_on":["module.ecs_service"]},"ecs_task_definition":{"source":"./modules/ecs_task_definition","expressions":{"availability_zones":{"references":["module.vpc.availability_zones","module.vpc"]},"cloudwatch_log_group_arn":{"references":["module.log_group.cloudwatch_log_group_arn","module.log_group"]},"cloudwatch_log_group_name":{"references":["module.log_group.cloudwatch_log_group_name","module.log_group"]},"container_name":{"constant_value":"nginx"},"cpu":{"constant_value":256},"docker_image":{"constant_value":"nginx:latest"},"example_env_value":{"constant_value":"example_value"},"execution_role_arn":{"references":["module.ecs_task_role.execution_role_arn","module.ecs_task_role"]},"family":{"references":["random_id.unique.hex","random_id.unique"]},"log_group_name":{"references":["module.log_group.cloudwatch_log_group_name","module.log_group"]},"log_region":{"references":["var.aws_region"]},"log_stream_prefix":{"constant_value":"ecs"},"memory":{"constant_value":512},"nginx_port":{"constant_value":80},"node_port":{"constant_value":3000},"task_role_arn":{"references":["module.ecs_task_role.task_role_arn","module.ecs_task_role"]}},"module":{"outputs":{"container_name":{"expression":{"references":["var.container_name"]}},"container_port":{"expression":{"constant_value":80}},"family":{"expression":{"references":["aws_ecs_task_definition.app.family","aws_ecs_task_definition.app"]}},"nginx_port":{"expression":{"references":["var.nginx_port"]}},"node_port":{"expression":{"references":["var.node_port"]}},"task_definition_arn":{"expression":{"references":["aws_ecs_task_definition.app.arn","aws_ecs_task_definition.app"]}}},"resources":[{"address":"aws_ecs_task_definition.app","mode":"managed","type":"aws_ecs_task_definition","name":"app","provider_config_key":"aws","expressions":{"container_definitions":{"references":["var.container_name","var.docker_image","var.cpu","var.memory","var.nginx_port","var.cloudwatch_log_group_name","var.log_region"]},"cpu":{"references":["var.cpu"]},"execution_role_arn":{"references":["var.execution_role_arn"]},"family":{"references":["var.family"]},"memory":{"references":["var.memory"]},"network_mode":{"constant_value":"bridge"},"requires_compatibilities":{"constant_value":["EC2"]},"task_role_arn":{"references":["var.task_role_arn"]},"volume":[{"host_path":{"constant_value":"/var/log/ecs/nginx"},"name":{"constant_value":"nginx-logs"}}]},"schema_version":1}],"variables":{"availability_zones":{"description":"List of availability zones"},"cloudwatch_log_group_arn":{"description":"ARN of the CloudWatch Log Group"},"cloudwatch_log_group_name":{"description":"ARN of the CloudWatch Log Group"},"container_name":{"description":"Name of the container"},"cpu":{"description":"CPU units for the task"},"docker_image":{"description":"The Docker image to use for the container"},"example_env_value":{"description":"Example environment variable value"},"execution_role_arn":{"description":"ARN of the task execution role"},"family":{"description":"A unique name for your task definition family"},"internal_app_port":{"default":3000,"description":"The port for the internal application (e.g., nodejs)"},"log_group_name":{"description":"Name of the CloudWatch log group"},"log_region":{"description":"AWS region for CloudWatch logs"},"log_stream_prefix":{"description":"Prefix for the log stream"},"memory":{"description":"Memory for the task in MiB"},"nginx_port":{"description":"Port number for Nginx container"},"node_port":{"description":"Port number for Node.js container"},"task_role_arn":{"description":"ARN of the task role"}}},"depends_on":["module.log_group"]},"ecs_task_role":{"source":"./modules/ecs_task_role","expressions":{"exec_role_name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"task_role_name_prefix":{"references":["random_id.unique.hex","random_id.unique"]}},"module":{"outputs":{"execution_role_arn":{"expression":{"references":["aws_iam_role.ecs_exec_role.arn","aws_iam_role.ecs_exec_role"]},"description":"ARN of the ECS Task Execution Role"},"task_role_arn":{"expression":{"references":["aws_iam_role.ecs_task_role.arn","aws_iam_role.ecs_task_role"]},"description":"ARN of the ECS Task Role"}},"resources":[{"address":"aws_iam_role.ecs_exec_role","mode":"managed","type":"aws_iam_role","name":"ecs_exec_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name_prefix":{"references":["var.exec_role_name_prefix"]}},"schema_version":0},{"address":"aws_iam_role.ecs_task_role","mode":"managed","type":"aws_iam_role","name":"ecs_task_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name_prefix":{"references":["var.task_role_name_prefix"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ecs_exec_role_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_exec_role_policy","provider_config_key":"aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"role":{"references":["aws_iam_role.ecs_exec_role.name","aws_iam_role.ecs_exec_role"]}},"schema_version":0}],"variables":{"exec_role_name_prefix":{"description":"Prefix for the ECS Task Execution Role name."},"task_role_name_prefix":{"description":"Prefix for the ECS Task Role name."}}}},"internet_gateway":{"source":"./modules/internet_gateway","expressions":{"azs_count":{"references":["local.azs_count"]},"azs_names":{"references":["local.azs_names"]},"create_eips":{"constant_value":true},"name":{"references":["random_id.unique.hex","random_id.unique"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"eip_ids":{"expression":{"references":["aws_eip.main"]},"description":"IDs of the Elastic IPs."},"internet_gateway_id":{"expression":{"references":["aws_internet_gateway.main.id","aws_internet_gateway.main"]},"description":"ID of the internet gateway."}},"resources":[{"address":"aws_eip.main","mode":"managed","type":"aws_eip","name":"main","provider_config_key":"aws","expressions":{"domain":{"constant_value":"vpc"},"tags":{"references":["var.azs_names","count.index"]}},"schema_version":0,"count_expression":{"references":["var.create_eips","var.azs_count"]},"depends_on":["aws_internet_gateway.main"]},{"address":"aws_internet_gateway.main","mode":"managed","type":"aws_internet_gateway","name":"main","provider_config_key":"aws","expressions":{"tags":{"references":["var.name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":0}],"variables":{"azs_count":{"description":"Number of availability zones to use for Elastic IPs."},"azs_names":{"description":"List of availability zone names for Elastic IPs."},"create_eips":{"default":true,"description":"Whether to create Elastic IPs for the Internet Gateway"},"name":{"description":"Name tag for the internet gateway."},"vpc_id":{"description":"ID of the VPC where the internet gateway will be attached."}}}},"log_group":{"source":"./modules/cloudwatch_logs","expressions":{"name_prefix":{"references":["random_id.unique.hex","random_id.unique"]},"retention_in_days":{"references":["var.cloudwatch_logs_retention_days"]}},"module":{"outputs":{"cloudwatch_log_group_arn":{"expression":{"references":["aws_cloudwatch_log_group.this.arn","aws_cloudwatch_log_group.this"]},"description":"ARN of Cloudwatch log group"},"cloudwatch_log_group_name":{"expression":{"references":["aws_cloudwatch_log_group.this.name","aws_cloudwatch_log_group.this"]},"description":"Name of Cloudwatch log group"}},"resources":[{"address":"aws_cloudwatch_log_group.this","mode":"managed","type":"aws_cloudwatch_log_group","name":"this","provider_config_key":"aws","expressions":{"name":{"references":["var.name_prefix"]},"retention_in_days":{"references":["var.retention_in_days"]}},"schema_version":0},{"address":"aws_cloudwatch_log_stream.this","mode":"managed","type":"aws_cloudwatch_log_stream","name":"this","provider_config_key":"aws","expressions":{"log_group_name":{"references":["aws_cloudwatch_log_group.this.name","aws_cloudwatch_log_group.this"]},"name":{"references":["var.name_prefix"]}},"schema_version":0}],"variables":{"name_prefix":{"description":"Name prefix for the log group"},"retention_in_days":{"default":7,"description":"Number of days to retain log events"}}}},"nat_gateway":{"source":"./modules/nat_gateway","expressions":{"az_count":{"references":["local.azs_count"]},"name_prefix":{"references":["var.name_prefix"]},"public_subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"region":{"references":["var.aws_region"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"eip_id":{"expression":{"references":["aws_eip.nat.id","aws_eip.nat"]},"description":"ID of the Elastic IP associated with the NAT Gateway"},"nat_gateway_id":{"expression":{"references":["aws_nat_gateway.main.id","aws_nat_gateway.main"]},"description":"ID of the NAT Gateway"},"nat_gateway_public_ip":{"expression":{"references":["aws_eip.nat.public_ip","aws_eip.nat"]},"description":"Public IP associated with the NAT Gateway"}},"resources":[{"address":"aws_eip.nat","mode":"managed","type":"aws_eip","name":"nat","provider_config_key":"aws","expressions":{"domain":{"constant_value":"vpc"},"tags":{"references":["var.name_prefix"]}},"schema_version":0},{"address":"aws_nat_gateway.main","mode":"managed","type":"aws_nat_gateway","name":"main","provider_config_key":"aws","expressions":{"allocation_id":{"references":["aws_eip.nat.id","aws_eip.nat"]},"subnet_id":{"references":["var.public_subnet_ids[0]","var.public_subnet_ids"]},"tags":{"references":["var.name_prefix"]}},"schema_version":0}],"variables":{"az_count":{"description":"Number of AZs to cover in a given region"},"existing_eip_ids":{"default":[],"description":"List of existing Elastic IP IDs to use for NAT Gateways"},"name_prefix":{"description":"Prefix to use for resource names"},"public_subnet_ids":{"description":"List of public subnet IDs"},"region":{"description":"AWS region"},"vpc_id":{"description":"ID of the VPC"}}}},"route_table":{"source":"./modules/route_table","expressions":{"availability_zones":{"references":["local.azs_names"]},"internet_gateway_id":{"references":["module.internet_gateway.internet_gateway_id","module.internet_gateway"]},"name":{"references":["var.name_prefix"]},"nat_gateway_id":{"references":["module.nat_gateway.nat_gateway_id","module.nat_gateway"]},"private_subnet_ids":{"references":["module.vpc.private_subnet_ids","module.vpc"]},"subnet_ids":{"references":["module.vpc.public_subnet_ids","module.vpc"]},"vpc_id":{"references":["module.vpc.vpc_id","module.vpc"]}},"module":{"outputs":{"private_route_table_ids":{"expression":{"references":["aws_route_table.private"]},"description":"List of IDs of private route tables"},"public_route_table_id":{"expression":{"references":["aws_route_table.public.id","aws_route_table.public"]},"description":"ID of the public route table"}},"resources":[{"address":"aws_route.private_nat_gateway","mode":"managed","type":"aws_route","name":"private_nat_gateway","provider_config_key":"aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"nat_gateway_id":{"references":["var.nat_gateway_id"]},"route_table_id":{"references":["aws_route_table.private","count.index"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_route.public_internet_gateway","mode":"managed","type":"aws_route","name":"public_internet_gateway","provider_config_key":"aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"gateway_id":{"references":["var.internet_gateway_id"]},"route_table_id":{"references":["aws_route_table.public.id","aws_route_table.public"]}},"schema_version":0},{"address":"aws_route_table.private","mode":"managed","type":"aws_route_table","name":"private","provider_config_key":"aws","expressions":{"tags":{"references":["var.name","count.index"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_config_key":"aws","expressions":{"tags":{"references":["var.name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":0},{"address":"aws_route_table_association.private","mode":"managed","type":"aws_route_table_association","name":"private","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.private","count.index"]},"subnet_id":{"references":["var.private_subnet_ids","count.index"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_route_table_association.public","mode":"managed","type":"aws_route_table_association","name":"public","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.public.id","aws_route_table.public"]},"subnet_id":{"references":["var.subnet_ids","count.index"]}},"schema_version":0,"count_expression":{"references":["var.subnet_ids"]}}],"variables":{"availability_zones":{"description":"List of availability zones"},"internet_gateway_id":{"description":"ID of the internet gateway used in the public route."},"name":{"description":"Name prefix for the route tables."},"nat_gateway_id":{"description":"ID of the NAT Gateway"},"private_subnet_ids":{"description":"List of private subnet IDs to associate with the private route tables."},"subnet_ids":{"description":"List of public subnet IDs to associate with the public route table."},"vpc_id":{"description":"ID of the VPC where the route tables will be created."}}}},"vpc":{"source":"./modules/vpc","expressions":{"availability_zones":{"references":["local.azs_names"]},"cidr_block":{"references":["var.vpc_cidr"]},"existing_vpc_id":{"constant_value":""},"name":{"references":["random_id.unique.hex","random_id.unique"]}},"module":{"outputs":{"availability_zones":{"expression":{"references":["var.availability_zones"]},"description":"List of AZs where subnets are created"},"private_subnet_ids":{"expression":{"references":["aws_subnet.private"]},"description":"IDs of the private subnets."},"public_subnet_ids":{"expression":{"references":["aws_subnet.public"]},"description":"IDs of the public subnets."},"vpc_cidr_block":{"expression":{"references":["aws_vpc.main.cidr_block","aws_vpc.main"]},"description":"The CIDR block of the VPC"},"vpc_id":{"expression":{"references":["aws_vpc.main.id","aws_vpc.main"]},"description":"The ID of the VPC"}},"resources":[{"address":"aws_subnet.private","mode":"managed","type":"aws_subnet","name":"private","provider_config_key":"aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.cidr_block","count.index","var.availability_zones"]},"tags":{"references":["var.name","var.availability_zones","count.index"]},"vpc_id":{"references":["local.vpc_id"]}},"schema_version":1,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_subnet.public","mode":"managed","type":"aws_subnet","name":"public","provider_config_key":"aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.cidr_block","count.index"]},"map_public_ip_on_launch":{"references":["var.map_public_ip_on_launch"]},"tags":{"references":["var.name","var.availability_zones","count.index"]},"vpc_id":{"references":["local.vpc_id"]}},"schema_version":1,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_vpc.main","mode":"managed","type":"aws_vpc","name":"main","provider_config_key":"aws","expressions":{"cidr_block":{"references":["var.cidr_block"]},"enable_dns_hostnames":{"constant_value":true},"enable_dns_support":{"constant_value":true},"tags":{"references":["var.name"]}},"schema_version":1}],"variables":{"availability_zones":{"description":"List of availability zones for the VPC"},"cidr_block":{"description":"The CIDR block for the VPC."},"existing_vpc_id":{"default":"","description":"ID of an existing VPC to use (leave blank to create a new VPC)"},"map_public_ip_on_launch":{"default":true,"description":"Specify true to indicate that instances launched into the subnet should be assigned a public IP address"},"name":{"description":"Name to be used on all the resources as identifier"}}}}},"variables":{"aws_region":{"default":"us-east-1","description":"The AWS region to deploy resources"},"capacity_provider_name":{"default":"demo-ecs-ec2","description":"The name of the capacity provider for the ECS service"},"cloudwatch_logs_name_prefix":{"default":"my-log-group-","description":"Prefix for the CloudWatch Log Group name"},"cloudwatch_logs_retention_days":{"default":1,"description":"Number of days to retain logs in the CloudWatch Log Group"},"desired_count":{"default":1,"description":"The desired number of tasks for the ECS service"},"ecs_service_count":{"default":1,"description":"Number of ECS services to create"},"example_env_value":{"default":"example","description":"An example environment variable value"},"existing_vpc_id":{"default":"","description":"ID of an existing VPC to use (leave blank to create a new VPC)"},"name_prefix":{"default":"demo","description":"Prefix for resource names"},"project_name":{"default":"demo","description":"Name of the project"},"task_cpu":{"default":"256","description":"The amount of CPU to allocate for the task"},"task_memory":{"default":"512","description":"The amount of memory to allocate for the task"},"vpc_cidr":{"default":"10.0.0.0/16","description":"The CIDR block for the VPC"}}}},"relevant_attributes":[{"resource":"module.ecs_node_role.aws_iam_instance_profile.ecs_node","attribute":["arn"]},{"resource":"module.nat_gateway.aws_nat_gateway.main","attribute":["id"]},{"resource":"module.ecs_cluster.aws_ecs_cluster.main","attribute":["name"]},{"resource":"module.ecs_task_role.aws_iam_role.ecs_exec_role","attribute":["arn"]},{"resource":"module.internet_gateway.aws_internet_gateway.main","attribute":["id"]},{"resource":"module.alb.aws_security_group.http","attribute":["id"]},{"resource":"module.ecs_launch_template.data.aws_region.current","attribute":["name"]},{"resource":"module.ecs_node_sg.aws_security_group.ecs_node_sg","attribute":["arn"]},{"resource":"module.vpc.aws_subnet.private","attribute":[]},{"resource":"module.internet_gateway.aws_eip.main","attribute":[]},{"resource":"tls_private_key.ssh_key","attribute":["public_key_openssh"]},{"resource":"module.ecs_node_role.data.aws_iam_policy_document.full_access","attribute":["json"]},{"resource":"module.route_table.aws_route_table.public","attribute":["id"]},{"resource":"module.ecs_node_role.aws_iam_policy.full_access","attribute":["arn"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_cpu","attribute":["name"]},{"resource":"module.ecs_service.aws_ecs_service.app","attribute":["name"]},{"resource":"module.ecs_task_role.aws_iam_role.ecs_exec_role","attribute":["name"]},{"resource":"module.alb.aws_lb_target_group.app","attribute":["arn"]},{"resource":"module.alb.aws_lb.main","attribute":["name"]},{"resource":"module.ecs_task_role.aws_iam_role.ecs_task_role","attribute":["arn"]},{"resource":"module.ecs_asg.aws_autoscaling_group.ecs","attribute":["name"]},{"resource":"module.alb.aws_lb.main","attribute":["arn"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","attribute":["scalable_dimension"]},{"resource":"module.vpc.aws_subnet.public","attribute":[]},{"resource":"module.ecs_service.aws_ecs_service.app","attribute":["id"]},{"resource":"module.route_table.aws_route_table.private","attribute":[]},{"resource":"module.log_group.aws_cloudwatch_log_group.this","attribute":["arn"]},{"resource":"module.ecs_asg.aws_autoscaling_group.ecs","attribute":["arn"]},{"resource":"module.nat_gateway.aws_eip.nat","attribute":["public_ip"]},{"resource":"module.ecs_asg.aws_autoscaling_group.ecs","attribute":["id"]},{"resource":"module.ecs_node_role.aws_iam_role.ecs_exec_role","attribute":["arn"]},{"resource":"module.ecs_launch_template.aws_launch_template.ecs_ec2","attribute":["id"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","attribute":["resource_id"]},{"resource":"module.vpc.aws_vpc.main","attribute":["id"]},{"resource":"module.ecs_capacity_provider.aws_ecs_cluster_capacity_providers.main","attribute":["capacity_providers"]},{"resource":"data.aws_instances.ecs_instances","attribute":["public_ips"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","attribute":["min_capacity"]},{"resource":"module.ecs_node_role.aws_iam_role.ecs_node_role","attribute":["name"]},{"resource":"module.alb.random_id.target_group_suffix","attribute":["hex"]},{"resource":"module.ecs_node_sg.aws_security_group.ecs_node_sg","attribute":["id"]},{"resource":"aws_key_pair.generated_key","attribute":["key_name"]},{"resource":"module.ecs_cluster.aws_ecs_cluster.main","attribute":["id"]},{"resource":"module.ecs_capacity_provider.aws_ecs_capacity_provider.main","attribute":["name"]},{"resource":"module.vpc.aws_vpc.main","attribute":["cidr_block"]},{"resource":"module.ecs_task_definition.aws_ecs_task_definition.app","attribute":["family"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_policy.ecs_target_memory","attribute":["name"]},{"resource":"random_id.unique","attribute":["hex"]},{"resource":"module.ecs_node_role.data.aws_iam_policy_document.ecs_node_doc","attribute":["json"]},{"resource":"module.ecs_node_sg.data.aws_vpc.selected","attribute":["cidr_block"]},{"resource":"module.ecs_node_role.aws_iam_role.ecs_node_role","attribute":["arn"]},{"resource":"module.alb.aws_lb.main","attribute":["dns_name"]},{"resource":"module.log_group.aws_cloudwatch_log_group.this","attribute":["name"]},{"resource":"module.nat_gateway.aws_eip.nat","attribute":["id"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","attribute":["service_namespace"]},{"resource":"data.aws_ami.ecs_optimized","attribute":["id"]},{"resource":"tls_private_key.ssh_key","attribute":["private_key_pem"]},{"resource":"module.ecs_task_definition.aws_ecs_task_definition.app","attribute":["arn"]},{"resource":"module.alb.aws_lb_listener.http","attribute":["arn"]},{"resource":"module.ecs_node_role.aws_iam_role.ecs_exec_role","attribute":["name"]},{"resource":"module.ecs_service_auto_scaling.aws_appautoscaling_target.ecs_target","attribute":["max_capacity"]},{"resource":"data.aws_availability_zones.available","attribute":["names"]}],"timestamp":"2024-10-15T23:02:44Z","applyable":true,"complete":true,"errored":false}
